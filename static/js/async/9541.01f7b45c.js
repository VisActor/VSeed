"use strict";(self.rspackChunkwebsite=self.rspackChunkwebsite||[]).push([["9541"],{57524(e,n,r){r.r(n),r.d(n,{default:()=>o});var t=r(78525),a=r(158),s=r(17636);function l(e){return(0,t.jsx)(s.A,{code:"const Demo = () => {\n  const MeasureNames = '__MeaName__'\n\n  const vseed: VSeed = {\n    chartType: 'column',\n    measures: [\n      {\n        id: 'sales',\n        alias: 'sales',\n        parentId: 'sales-and-profit',\n      },\n      {\n        id: 'rateOfReturn',\n        alias: '回报率',\n        parentId: 'ratio',\n      },\n    ],\n    dataset: [\n      { date: '2019', profit: 10, sales: 20, rateOfReturn: 0.1 },\n      { date: '2020', profit: 20, sales: 40, rateOfReturn: 0.2 },\n      { date: '2021', profit: 30, sales: 60, rateOfReturn: 0.3 },\n      { date: '2022', profit: 40, sales: 80, rateOfReturn: 0.4 },\n      { date: '2023', profit: 50, sales: 100, rateOfReturn: 0.5 },\n    ],\n    dimensions: [\n      {\n        id: 'date',\n        alias: '日期',\n      },\n    ],\n    brush: {\n      enable: true,\n      brushType: 'x',\n    },\n  }\n\n  const parseRes = zVSeed.safeParse(vseed)\n  if (parseRes.success) {\n    console.log('zVSeed parse success!!!')\n  } else {\n    console.error('zVSeed parse error!!!', parseRes)\n  }\n\n  return <SimpleVSeedRender vseed={vseed} />\n}\n\nimport { useRef, useEffect } from 'react'\nimport { useDark } from '@rspress/core/runtime'\nimport VChart from '@visactor/vchart'\nimport { ListTable, PivotTable, PivotChart, register } from '@visactor/vtable'\nimport {\n  registerAll,\n  VSeed,\n  Builder,\n  isPivotChart,\n  isVChart,\n  isPivotTable,\n  isTable,\n  zVSeed,\n  ColorIdEncoding,\n  DATUM_HIDE_KEY,\n} from '@visactor/vseed'\n\nregisterAll()\nregister.chartModule('vchart', VChart)\n\nconst SimpleVSeedRender = (props: { vseed: VSeed }) => {\n  const { vseed } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const builderRef = useRef<Builder>()\n  const dark = useDark()\n  const selectedDimValueRef = useRef<string[]>([])\n  useEffect(() => {\n    if (!ref.current) {\n      return\n    }\n    const theme = dark ? 'dark' : 'light'\n    const builder = Builder.from(vseed.theme ? vseed : { ...vseed, theme })\n    let spec = builder.build()\n    spec = {\n      ...spec,\n      chartDimensionLinkage: {\n        ...spec.chartDimensionLinkage,\n        clearChartState: () => {\n          console.log('!!ClearChartState')\n          selectedDimValueRef.current = []\n          window.pivotChart.enableTooltipToAllChartInstances()\n        },\n        inBrushStateFilter: (datum) => {\n          console.log('inBrushState', datum, selectedDimValueRef.current)\n          return selectedDimValueRef.current.length ? selectedDimValueRef.current.includes(datum['__Dim_X__']) : true\n        },\n        outOfBrushStateFilter: (datum) => {\n          return selectedDimValueRef.current.length ? !selectedDimValueRef.current.includes(datum['__Dim_X__']) : false\n        },\n        listenBrushChange: true,\n        brushChangeDelay: 100,\n      },\n    }\n    console.log('final spec = ', spec)\n    console.log('builder', builder)\n    console.log('builder performance', builder.performance)\n\n    builderRef.current = builder\n    if (isPivotChart(vseed)) {\n      const tableInstance = new PivotChart(ref.current, spec)\n\n      tableInstance.on('legend_item_click', (args) => {\n        console.log('LEGEND_ITEM_CLICK', args)\n        tableInstance.updateFilterRules([\n          {\n            filterKey: ColorIdEncoding,\n            filteredValues: args.value,\n          },\n        ])\n      })\n      tableInstance.onVChartEvent('brushEnd', (args) => {\n        console.log('brushEnd', args)\n        selectedDimValueRef.current = args.value.inBrushData.map((dataItem) => dataItem.__Dim_X__)\n      })\n      tableInstance.onVChartEvent('brushStart', (args) => {\n        window.pivotChart.enableTooltipToAllChartInstances()\n      })\n      tableInstance.onVChartEvent('brushChange', (args) => {\n        console.log('brushChange', args)\n        selectedDimValueRef.current = args.value.inBrushData.map((dataItem) => dataItem.__Dim_X__)\n      })\n\n      tableInstance.on('legend_change', (args) => {\n        const maxValue = args.value[1]\n        const minValue = args.value[0]\n\n        if (vseed.chartType === 'heatmap') {\n          tableInstance.updateFilterRules([\n            {\n              filterFunc: (record) => {\n                const value = record[record[ColorIdEncoding]]\n                const isShow = value >= minValue && value <= maxValue\n\n                record[DATUM_HIDE_KEY] = !isShow\n\n                return true\n              },\n            },\n          ])\n        } else {\n          tableInstance.updateFilterRules([\n            {\n              filterFunc: (record) => {\n                const value = record[record[ColorIdEncoding]]\n                if (value >= minValue && value <= maxValue) {\n                  return true\n                }\n                return false\n              },\n            },\n          ])\n        }\n      })\n      window.pivotChart = tableInstance\n      return () => tableInstance.release()\n    } else if (isVChart(vseed)) {\n      const vchart = new VChart(spec, { dom: ref.current })\n      vchart.renderSync()\n\n      vchart.on('brushEnd', (e) => {\n        console.log(e)\n      })\n\n      window.vchart = vchart\n      return () => vchart.release()\n    } else if (isTable(vseed)) {\n      const tableInstance = new ListTable(ref.current, spec)\n      window.table = tableInstance\n      return () => tableInstance.release()\n    } else if (isPivotTable(vseed)) {\n      const tableInstance = new PivotTable(ref.current, spec)\n\n      window.table = tableInstance\n      return () => tableInstance.release()\n    }\n  }, [vseed, dark])\n\n  return (\n    <div\n      ref={ref}\n      style={{ height: 300, width: '100%' }}\n      onClick={() => {\n        console.group(`selected ${vseed.chartType}`)\n        console.log('builder', builderRef.current)\n        console.log('spec', builderRef.current.spec)\n        console.log('vseed', builderRef.current.vseed)\n        console.log('advancedVSeed', builderRef.current.advancedVSeed)\n        console.groupEnd()\n      }}\n    >\n      {' '}\n    </div>\n  )\n}\n\nexport default Demo",language:"tsx",direction:"",editorPosition:"left"})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["zh-CN%2Fplayground%2Fvseed.mdx"]={toc:[],title:"标题",headingTitle:"",frontmatter:{title:"标题",playgroundDirection:"horizontal",pageType:"custom"}}}}]);
//# sourceMappingURL=9541.01f7b45c.js.map