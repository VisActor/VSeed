"use strict";(self.rspackChunkwebsite=self.rspackChunkwebsite||[]).push([["7162"],{99553(e,t,r){let n;r.r(t),r.d(t,{default:()=>$});var s=r(78525),i=r(158),l=r(39081),a=r(95948),o=r(35039),d=r(76362),c=r(27835),u=r(22677),p=r(88428),g=r(76365),m=r(77458),y=r(55838);(0,p.P)(),o.tZ("vchart",a.Ay$);let h=e=>{let{vseed:t}=e,r=(0,l.useRef)(null),n=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!r.current)return;let e=g.M.from({...t,theme:"light"}),s=e.build();if(n.current=e,(0,m.Zq)(t)){let e=new d.r(r.current,s);return e.on("legend_item_click",t=>{console.log("LEGEND_ITEM_CLICK",t),e.updateFilterRules([{filterKey:y.Qb,filteredValues:t.value}])}),e.on("legend_change",t=>{let r=t.value[1],n=t.value[0];e.updateFilterRules([{filterFunc:e=>{let t=e[e[y.Qb]];return!!(t>=n)&&!!(t<=r)}}])}),()=>e.release()}if((0,m.xr)(t)){let e=new a.Ay$(s,{dom:r.current});return e.renderSync(),()=>e.release()}if((0,m.bI)(t)){let e=new c.u(r.current,s);return()=>e.release()}if((0,m.RW)(t)){let e=new u.M(r.current,s);return()=>e.release()}},[t]),(0,s.jsx)("div",{ref:r,style:{height:"100%",width:"100%",minHeight:300},onClick:()=>{console.group(`selected ${t.chartType}`),console.log("builder",n.current),console.log("spec",n.current&&n.current.spec),console.log("vseed",n.current&&n.current.vseed),console.log("advancedVSeed",n.current&&n.current.advancedVSeed),console.groupEnd()}})};var x=r(83920),f=r(88527),v=r(300),b=r(83767),j=r(77509),A=r(60059),w=r(24558);let S="demo";n=new w.VQuery,A.VBI.registerConnector(S,async()=>({discoverSchema:async()=>[{name:"id",type:"string"},{name:"order_id",type:"string"},{name:"order_date",type:"date"},{name:"delivery_date",type:"date"},{name:"delivery_method",type:"string"},{name:"customer_id",type:"string"},{name:"customer_name",type:"string"},{name:"customer_type",type:"string"},{name:"city",type:"string"},{name:"province",type:"string"},{name:"country_or_region",type:"string"},{name:"area",type:"string"},{name:"product_id",type:"string"},{name:"product_type",type:"string"},{name:"product_sub_type",type:"string"},{name:"product_name",type:"string"},{name:"sales",type:"number"},{name:"amount",type:"number"},{name:"discount",type:"number"},{name:"profit",type:"number"}],query:async e=>{let{queryDSL:t,schema:r}=e;await n.hasDataset(S)||await n.createDataset(S,r,{type:"csv",rawDataset:"https://visactor.github.io/VBI/dataset/supermarket.csv"});let s=await n.connectDataset(S);return{dataset:(await s.query(t)).dataset}}}));let _=A.VBI.from(A.VBI.generateEmptyDSL(S)),C=(0,r(78064).v)((e,t)=>({loading:!1,vseed:null,initialized:!1,builder:_,dsl:_.dsl.toJSON(),setLoading:t=>e({loading:t}),setVSeed:t=>e({vseed:t}),setDsl:t=>e({dsl:t}),initialize:r=>{r&&e({builder:r}),e({initialized:!0});let n=t().bindEvent();return()=>{n(),e({loading:!1,vseed:null,initialized:!1})}},bindEvent:()=>{let{builder:e,setLoading:r,setVSeed:n,setDsl:s}=t(),i=async()=>{r(!0);try{let t=await e.buildVSeed();n(t),s(e.dsl.toJSON())}finally{r(!1)}};return e.doc.on("update",i),()=>{e.doc.off("update",i)}}})),E=e=>{let{style:t}=e,r=C(e=>e.builder);console.log("debug DimensionsList rerender");let[n,i]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{i(await r.getSchema())})()},[r]);let a=n.filter(e=>"number"===e.type);return(0,s.jsx)(v.A,{title:"Measures",style:{...t},styles:{body:{padding:"0 0 10px 0",flex:1,overflowY:"auto",minHeight:0,height:"calc(100% - 48px)"},header:{minHeight:"48px"}},children:(0,s.jsx)(b.A,{size:"small",dataSource:a,split:!1,renderItem:e=>{let t;return(0,s.jsx)(b.A.Item,{style:{padding:0,marginBottom:2},children:(0,s.jsxs)("div",{onClick:(t=e.name,()=>{r.doc.transact(()=>{r.measures.addMeasure(t,e=>{e.setAlias(t),e.setAggregate({func:"sum"})})})}),style:{display:"flex",alignItems:"center",width:"100%",padding:"4px 12px",cursor:"pointer",borderRadius:"4px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.04)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:[(0,s.jsx)("span",{style:{marginRight:8,display:"flex",alignItems:"center"},children:(0,s.jsx)(j.A,{style:{color:"#52c41a"}})}),(0,s.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"13px"},children:e.name})]})})}})})};var k=r(19512),I=r(57e3);let T=(0,l.memo)(e=>{let{style:t}=e,r=C(e=>e.builder);console.log("debug DimensionsList rerender");let[n,i]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{i(await r.getSchema())})()},[r]);let a=n.filter(e=>"number"!==e.type);return(0,s.jsx)(v.A,{title:"Dimensions",style:{...t},styles:{body:{padding:"0 0 10px 0",flex:1,overflowY:"auto",minHeight:0,height:"calc(100% - 48px)"},header:{minHeight:"48px"}},children:(0,s.jsx)(b.A,{size:"small",dataSource:a,split:!1,renderItem:e=>{let t;return(0,s.jsx)(b.A.Item,{style:{padding:0,marginBottom:2},children:(0,s.jsxs)("div",{onClick:(t=e.name,()=>{r.doc.transact(()=>{r.dimensions.addDimension(t,e=>{e.setAlias(t)})})}),style:{display:"flex",alignItems:"center",width:"100%",padding:"4px 12px",cursor:"pointer",borderRadius:"4px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.04)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:[(0,s.jsx)("span",{style:{marginRight:8,display:"flex",alignItems:"center"},children:"date"===e.type?(0,s.jsx)(k.A,{style:{color:"#1890ff"}}):(0,s.jsx)(I.A,{style:{color:"#1890ff"}})}),(0,s.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"13px"},children:e.name})]})})}})})});var D=r(26710);let M=e=>{let t=C(e=>e.builder),r=C(e=>e.dsl.chartType),{style:n}=e,i=t.chartType.getAvailableChartTypes();return(0,s.jsx)("div",{style:n,children:(0,s.jsx)(D.A,{defaultValue:t.chartType.getChartType(),value:r,onChange:e=>{t.chartType.changeChartType(e)},style:{width:"100%"},children:i.map(e=>(0,s.jsx)(D.A.Option,{value:e,children:e},e))})})};var z=r(90881),R=r(89768),V=r(93036);let B=e=>{let{style:t}=e,r=C(e=>e.builder),[n,i]=(0,l.useState)(r.measures.getMeasures());return(0,l.useEffect)(()=>{let e=(e,t)=>{console.info("[observe] measures",e,t),i(r.measures.getMeasures())};return r.measures.observe(e),()=>{r.measures.unobserve(e)}},[r]),(0,s.jsx)(f.A,{vertical:!1,gap:5,style:{flexBasis:300,...t},children:n.map(e=>(0,s.jsxs)(R.A.Compact,{children:[(0,s.jsx)(V.Ay,{style:{color:"green"},children:e.field}),(0,s.jsx)(V.Ay,{icon:(0,s.jsx)(z.A,{}),onClick:()=>{var t;return t=e.field,void r.measures.removeMeasure(t)}})]},`measure-shelf-${e.field}`))})},H=e=>{let{style:t}=e,r=C(e=>e.builder),[n,i]=(0,l.useState)(r.dimensions.getDimensions());return(0,l.useEffect)(()=>{let e=(e,t)=>{console.info("[observe] dimensions",e,t),i(r.dimensions.getDimensions())};return r.dimensions.observe(e),()=>{r.dimensions.unobserve(e)}},[r]),(0,s.jsx)(f.A,{vertical:!1,gap:5,style:{flexBasis:300,...t},children:n.map(e=>(0,s.jsxs)(R.A.Compact,{children:[(0,s.jsx)(V.Ay,{style:{color:"blue"},children:e.field}),(0,s.jsx)(V.Ay,{icon:(0,s.jsx)(z.A,{}),onClick:()=>{var t;return t=e.field,void r.dimensions.removeDimension(t)}})]},`dimension-shelf-${e.field}`))})};var L=r(36727);let P=e=>{console.log("debug APP rerender");let{initialize:t,initialized:r}=C((0,L.k)(e=>({initialize:e.initialize,initialized:e.initialized})));return((0,l.useEffect)(()=>t(e.builder),[]),r)?(0,s.jsxs)(f.A,{vertical:!1,onClick:()=>{console.group("selected vbi"),console.log("state",C.getState()),console.groupEnd()},style:{padding:"20px",gap:"20px"},children:[(0,s.jsxs)(f.A,{vertical:!0,gap:20,style:{flexBasis:300},children:[(0,s.jsx)(M,{style:{flexBasis:32,minHeight:0}}),(0,s.jsx)(T,{style:{flex:1,minHeight:0}}),(0,s.jsx)(E,{style:{flex:1,minHeight:0}})]}),(0,s.jsxs)(f.A,{vertical:!0,gap:20,style:{flexGrow:1},children:[(0,s.jsx)(v.A,{styles:{body:{padding:"12px"}},children:(0,s.jsxs)(f.A,{vertical:!0,gap:8,children:[(0,s.jsxs)(f.A,{align:"center",children:[(0,s.jsx)("div",{style:{width:100,fontWeight:500},children:"Dimensions"}),(0,s.jsx)(H,{style:{flex:1,minHeight:0}})]}),(0,s.jsxs)(f.A,{align:"center",children:[(0,s.jsx)("div",{style:{width:100,fontWeight:500},children:"Measures"}),(0,s.jsx)(B,{style:{flex:1,minHeight:0}})]})]})}),(0,s.jsx)(F,{})]})]}):(0,s.jsx)(x.A,{tip:"Initializing...",fullscreen:!0})},F=()=>{let e=C(e=>e.vseed),t=C(e=>e.loading);return(0,s.jsx)(v.A,{loading:t,styles:{root:{height:"100%"},body:{padding:"12px",height:"100%"}},children:e&&(0,s.jsx)(h,{vseed:e})})};function O(e){return(0,s.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,s.jsx)(P,{})})}function $(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(O,{...e})}):O(e)}$.__RSPRESS_PAGE_META={},$.__RSPRESS_PAGE_META["zh-CN%2Fvbi%2Fdemo.mdx"]={toc:[],title:"",headingTitle:"",frontmatter:{}}}}]);
//# sourceMappingURL=7162.0e0637e5.js.map