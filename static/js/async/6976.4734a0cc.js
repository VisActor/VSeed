"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["6976"],{62853:function(e,t,n){n.r(t),n.d(t,{default:()=>F});var s=n(31549),r=n(6603),i=n(44194),l=n(14385),a=n(59610),o=n(85646),d=n(61635),c=n(17426),u=n(61526),p=n(91542),g=n(36147),m=n(10414);(0,u.C)(),a.tg("vchart",l.ZPm);let y=e=>{let{vseed:t}=e,n=(0,i.useRef)(null),r=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!n.current)return;let e=p.I.from({...t,theme:"light"}),s=e.build();if(r.current=e,(0,g.QS)(t)){let e=new o.z(n.current,s);return e.on("legend_item_click",t=>{console.log("LEGEND_ITEM_CLICK",t),e.updateFilterRules([{filterKey:m.A8,filteredValues:t.value}])}),e.on("legend_change",t=>{let n=t.value[1],s=t.value[0];e.updateFilterRules([{filterFunc:e=>{let t=e[e[m.A8]];return!!(t>=s)&&!!(t<=n)}}])}),()=>e.release()}if((0,g.ey)(t)){let e=new l.ZPm(s,{dom:n.current});return e.renderSync(),()=>e.release()}if((0,g.wb)(t)){let e=new d.T(n.current,s);return()=>e.release()}if((0,g.vs)(t)){let e=new c.I(n.current,s);return()=>e.release()}},[t]),(0,s.jsx)("div",{ref:n,style:{height:"100%",width:"100%",minHeight:300},onClick:()=>{console.group(`selected ${t.chartType}`),console.log("builder",r.current),console.log("spec",r.current&&r.current.spec),console.log("vseed",r.current&&r.current.vseed),console.log("advancedVSeed",r.current&&r.current.advancedVSeed),console.groupEnd()}})};var h=n(9405),x=n(51040),f=n(28677),v=n(38506),b=n(40474),j=n(18152),w=n(81723);let Z="demo";(()=>{let e=new w.VQuery;return j.VBI.registerConnector(Z,async()=>({discoverSchema:async()=>[{name:"id",type:"string"},{name:"order_id",type:"string"},{name:"order_date",type:"date"},{name:"delivery_date",type:"date"},{name:"delivery_method",type:"string"},{name:"customer_id",type:"string"},{name:"customer_name",type:"string"},{name:"customer_type",type:"string"},{name:"city",type:"string"},{name:"province",type:"string"},{name:"country_or_region",type:"string"},{name:"area",type:"string"},{name:"product_id",type:"string"},{name:"product_type",type:"string"},{name:"product_sub_type",type:"string"},{name:"product_name",type:"string"},{name:"sales",type:"number"},{name:"amount",type:"number"},{name:"discount",type:"number"},{name:"profit",type:"number"}],query:async t=>{let{queryDSL:n,schema:s}=t;await e.hasDataset(Z)||await e.createDataset(Z,s,{type:"csv",rawDataset:"https://visactor.github.io/VSeed/dataset/supermarket.csv"});let r=await e.connectDataset(Z);return{dataset:(await r.query(n)).dataset}}}))})();let S=j.VBI.from(j.VBI.generateEmptyDSL(Z)),_=(0,n(5811).U)((e,t)=>({loading:!1,vseed:null,initialized:!1,builder:S,dsl:S.dsl.toJSON(),setLoading:t=>e({loading:t}),setVSeed:t=>e({vseed:t}),setDsl:t=>e({dsl:t}),initialize:n=>{n&&e({builder:n}),e({initialized:!0});let s=t().bindEvent();return()=>{s(),e({loading:!1,vseed:null,initialized:!1})}},bindEvent:()=>{let{builder:e,setLoading:n,setVSeed:s,setDsl:r}=t(),i=async()=>{n(!0);try{let t=await e.buildVSeed();s(t),r(e.dsl.toJSON())}finally{n(!1)}};return e.doc.on("update",i),()=>{e.doc.off("update",i)}}})),C=e=>{let{style:t}=e,n=_(e=>e.builder);console.log("debug DimensionsList rerender");let[r,l]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{l(await n.getSchema())})()},[n]);let a=e=>()=>{n.doc.transact(()=>{n.measures.addMeasure(e,t=>{t.setAlias(e),t.setAggregate({func:"sum"})})})},o=r.filter(e=>"number"===e.type);return(0,s.jsx)(f.Z,{title:"Measures",style:{...t},styles:{body:{padding:"0 0 10px 0",flex:1,overflowY:"auto",minHeight:0,height:"calc(100% - 48px)"},header:{minHeight:"48px"}},children:(0,s.jsx)(v.Z,{size:"small",dataSource:o,split:!1,renderItem:e=>(0,s.jsx)(v.Z.Item,{style:{padding:0,marginBottom:2},children:(0,s.jsxs)("div",{onClick:a(e.name),style:{display:"flex",alignItems:"center",width:"100%",padding:"4px 12px",cursor:"pointer",borderRadius:"4px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.04)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:[(0,s.jsx)("span",{style:{marginRight:8,display:"flex",alignItems:"center"},children:(0,s.jsx)(b.Z,{style:{color:"#52c41a"}})}),(0,s.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"13px"},children:e.name})]})})})})};var E=n(46857),k=n(69535);let T=(0,i.memo)(e=>{let{style:t}=e,n=_(e=>e.builder);console.log("debug DimensionsList rerender");let[r,l]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{l(await n.getSchema())})()},[n]);let a=e=>()=>{n.doc.transact(()=>{n.dimensions.addDimension(e,t=>{t.setAlias(e)})})},o=r.filter(e=>"number"!==e.type),d=e=>"date"===e?(0,s.jsx)(E.Z,{style:{color:"#1890ff"}}):(0,s.jsx)(k.Z,{style:{color:"#1890ff"}});return(0,s.jsx)(f.Z,{title:"Dimensions",style:{...t},styles:{body:{padding:"0 0 10px 0",flex:1,overflowY:"auto",minHeight:0,height:"calc(100% - 48px)"},header:{minHeight:"48px"}},children:(0,s.jsx)(v.Z,{size:"small",dataSource:o,split:!1,renderItem:e=>(0,s.jsx)(v.Z.Item,{style:{padding:0,marginBottom:2},children:(0,s.jsxs)("div",{onClick:a(e.name),style:{display:"flex",alignItems:"center",width:"100%",padding:"4px 12px",cursor:"pointer",borderRadius:"4px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.04)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:[(0,s.jsx)("span",{style:{marginRight:8,display:"flex",alignItems:"center"},children:d(e.type)}),(0,s.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"13px"},children:e.name})]})})})})});var z=n(23131);let D=e=>{let t=_(e=>e.builder),n=_(e=>e.dsl.chartType),{style:r}=e,i=t.chartType.getAvailableChartTypes();return(0,s.jsx)("div",{style:r,children:(0,s.jsx)(z.Z,{defaultValue:t.chartType.getChartType(),value:n,onChange:e=>{t.chartType.changeChartType(e)},style:{width:"100%"},children:i.map(e=>(0,s.jsx)(z.Z.Option,{value:e,children:e},e))})})};var I=n(94400),M=n(67556),P=n(22770);let R=e=>{let{style:t}=e,n=_(e=>e.builder),[r,l]=(0,i.useState)(n.measures.getMeasures());(0,i.useEffect)(()=>{let e=(e,t)=>{console.info("[observe] measures",e,t),l(n.measures.getMeasures())};return n.measures.observe(e),()=>{n.measures.unobserve(e)}},[n]);let a=e=>{n.measures.removeMeasure(e)};return(0,s.jsx)(x.Z,{vertical:!1,gap:5,style:{flexBasis:300,...t},children:r.map(e=>(0,s.jsxs)(M.Z.Compact,{children:[(0,s.jsx)(P.ZP,{style:{color:"green"},children:e.field}),(0,s.jsx)(P.ZP,{icon:(0,s.jsx)(I.Z,{}),onClick:()=>a(e.field)})]},`measure-shelf-${e.field}`))})},A=e=>{let{style:t}=e,n=_(e=>e.builder),r=e=>{n.dimensions.removeDimension(e)},[l,a]=(0,i.useState)(n.dimensions.getDimensions());return(0,i.useEffect)(()=>{let e=(e,t)=>{console.info("[observe] dimensions",e,t),a(n.dimensions.getDimensions())};return n.dimensions.observe(e),()=>{n.dimensions.unobserve(e)}},[n]),(0,s.jsx)(x.Z,{vertical:!1,gap:5,style:{flexBasis:300,...t},children:l.map(e=>(0,s.jsxs)(M.Z.Compact,{children:[(0,s.jsx)(P.ZP,{style:{color:"blue"},children:e.field}),(0,s.jsx)(P.ZP,{icon:(0,s.jsx)(I.Z,{}),onClick:()=>r(e.field)})]},`dimension-shelf-${e.field}`))})};var V=n(4474);let H=e=>{console.log("debug APP rerender");let{initialize:t,initialized:n}=_((0,V.N)(e=>({initialize:e.initialize,initialized:e.initialized})));return((0,i.useEffect)(()=>t(e.builder),[]),n)?(0,s.jsxs)(x.Z,{vertical:!1,onClick:()=>{console.group("selected vbi"),console.log("state",_.getState()),console.groupEnd()},style:{padding:"20px",gap:"20px"},children:[(0,s.jsxs)(x.Z,{vertical:!0,gap:20,style:{flexBasis:300},children:[(0,s.jsx)(D,{style:{flexBasis:32,minHeight:0}}),(0,s.jsx)(T,{style:{flex:1,minHeight:0}}),(0,s.jsx)(C,{style:{flex:1,minHeight:0}})]}),(0,s.jsxs)(x.Z,{vertical:!0,gap:20,style:{flexGrow:1},children:[(0,s.jsx)(f.Z,{styles:{body:{padding:"12px"}},children:(0,s.jsxs)(x.Z,{vertical:!0,gap:8,children:[(0,s.jsxs)(x.Z,{align:"center",children:[(0,s.jsx)("div",{style:{width:100,fontWeight:500},children:"Dimensions"}),(0,s.jsx)(A,{style:{flex:1,minHeight:0}})]}),(0,s.jsxs)(x.Z,{align:"center",children:[(0,s.jsx)("div",{style:{width:100,fontWeight:500},children:"Measures"}),(0,s.jsx)(R,{style:{flex:1,minHeight:0}})]})]})}),(0,s.jsx)(B,{})]})]}):(0,s.jsx)(h.Z,{tip:"Initializing...",fullscreen:!0})},B=()=>{let e=_(e=>e.vseed),t=_(e=>e.loading);return(0,s.jsx)(f.Z,{loading:t,styles:{root:{height:"100%"},body:{padding:"12px",height:"100%"}},children:e&&(0,s.jsx)(y,{vseed:e})})};function L(e){return(0,s.jsx)(H,{})}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,r.ah)(),e.components);return t?(0,s.jsx)(t,Object.assign({},e,{children:(0,s.jsx)(L,e)})):L(e)}let F=O;O.__RSPRESS_PAGE_META={},O.__RSPRESS_PAGE_META["zh-CN%2Fplayground%2Fdemo.mdx"]={toc:[],title:"标题",headingTitle:"",frontmatter:{title:"标题",playgroundDirection:"horizontal",pageType:"custom"}}}}]);
//# sourceMappingURL=6976.4734a0cc.js.map