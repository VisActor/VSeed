{"version":3,"file":"static/js/async/2453.03b00e56.js","sources":["../../../../../../packages/vbi/src/builder/sub-builders/dimensions/dimension-node-builder.ts","../../../../../../packages/vbi/src/builder/sub-builders/dimensions/dimensions-builder.ts","../../../../../../packages/vbi/src/builder/sub-builders/measures/measure-node-builder.ts","../../../../../../packages/vbi/src/builder/sub-builders/measures/measures-builder.ts","../../../../../../packages/vbi/src/pipeline/vqueryDSL/buildVQuery.ts","../../../../../../packages/vbi/src/builder/sub-builders/chart-type/chart-type-builder.ts","../../../../../../packages/vbi/src/builder/connector.ts","../../../../../../packages/vbi/src/builder/vbi-builder.ts","../../../../../../packages/vbi/src/builder/vbi.ts","../../../../../../packages/vbi/src/insight/index.ts","../../../../../../packages/vquery/src/sql-builder/dialect/postgresDialect.ts","../../../../../../packages/vquery/src/sql-builder/utils.ts","../../../../../../packages/vquery/src/sql-builder/dslToSQL.ts","../../../../../../packages/vquery/src/sql-builder/builders/where.ts","../../../../../../packages/vquery/src/sql-builder/builders/limit.ts","../../../../../../packages/vquery/src/sql-builder/builders/groupBy.ts","../../../../../../packages/vquery/src/sql-builder/compile/inlineParameters.ts","../../../../../../packages/vquery/src/utils/url.ts","../../../../../../packages/vquery/src/data-source-builder/dataSourceBuilder.ts","../../../../../../packages/vquery/src/adapters/storage-adapter/indexeddbAdapter.ts","../../../../../../packages/vquery/src/adapters/query-adapter/duckdbWebAdapter.ts","../../../../../../packages/vquery/src/dataset/dataset.ts","../../../../../../packages/vquery/src/vquery-browser.ts"],"sourcesContent":["import * as Y from 'yjs'\nimport { VBIDimension } from '../../../types'\n\nexport class DimensionNodeBuilder {\n  constructor(private yMap: Y.Map<any>) {}\n\n  setAlias(alias: string): this {\n    this.yMap.set('alias', alias)\n    return this\n  }\n\n  build(): VBIDimension {\n    return this.yMap.toJSON() as VBIDimension\n  }\n}\n","import * as Y from 'yjs'\nimport type { ObserveCallback, VBIDimension, VBIDimensionGroup, VBIDimensionTree } from 'src/types'\nimport { DimensionNodeBuilder } from './dimension-node-builder'\n\nexport class DimensionsBuilder {\n  private dsl: Y.Map<any>\n  private doc: Y.Doc\n  constructor(doc: Y.Doc, dsl: Y.Map<any>) {\n    this.doc = doc\n    this.dsl = dsl\n  }\n\n  addDimension(fieldOrDimension: VBIDimension['field'] | VBIDimension): DimensionNodeBuilder\n  addDimension(\n    fieldOrDimension: VBIDimension['field'] | VBIDimension,\n    callback: (dimensionNode: DimensionNodeBuilder) => void,\n  ): DimensionsBuilder\n  addDimension(\n    fieldOrDimension: VBIDimension['field'] | VBIDimension,\n    callback?: (dimensionNode: DimensionNodeBuilder) => void,\n  ): DimensionNodeBuilder | DimensionsBuilder {\n    const defaultDimension: VBIDimension = {} as VBIDimension\n    if (typeof fieldOrDimension === 'string') {\n      defaultDimension.alias = fieldOrDimension\n      defaultDimension.field = fieldOrDimension\n    } else {\n      defaultDimension.alias = fieldOrDimension.alias\n      defaultDimension.field = fieldOrDimension.field || fieldOrDimension.alias\n    }\n\n    const yMap = new Y.Map<any>()\n    for (const [key, value] of Object.entries(defaultDimension)) {\n      yMap.set(key, value)\n    }\n\n    this.dsl.get('dimensions').push([yMap])\n    const dimensionNode = new DimensionNodeBuilder(yMap)\n\n    if (callback) {\n      callback(dimensionNode)\n      return this\n    } else {\n      return dimensionNode\n    }\n  }\n\n  removeDimension(field: VBIDimension['field']) {\n    const dimensions = this.dsl.get('dimensions')\n    const index = dimensions.toArray().findIndex((item: any) => item.get('field') === field)\n    if (index !== -1) {\n      this.dsl.get('dimensions').delete(index, 1)\n    }\n  }\n\n  getDimensions(): VBIDimension[] {\n    return this.dsl.get('dimensions').toJSON()\n  }\n\n  observe(callback: ObserveCallback) {\n    this.dsl.get('dimensions').observe(callback)\n  }\n\n  unobserve(callback: ObserveCallback) {\n    this.dsl.get('dimensions').unobserve(callback)\n  }\n\n  static isDimensionNode(node: VBIDimensionTree[0]): node is VBIDimension {\n    return 'alias' in node && !('children' in node)\n  }\n\n  static isDimensionGroup(node: VBIDimensionTree[0]): node is VBIDimensionGroup {\n    return 'children' in node\n  }\n}\n","import * as Y from 'yjs'\nimport { VBIMeasure } from '../../../types'\n\nexport class MeasureNodeBuilder {\n  constructor(private yMap: Y.Map<any>) {}\n\n  setAlias(alias: string): this {\n    this.yMap.set('alias', alias)\n    return this\n  }\n\n  setEncoding(encoding: VBIMeasure['encoding']): this {\n    this.yMap.set('encoding', encoding)\n    return this\n  }\n\n  setAggregate(aggregate: VBIMeasure['aggregate']): this {\n    this.yMap.set('aggregate', aggregate)\n    return this\n  }\n\n  build(): VBIMeasure {\n    return this.yMap.toJSON() as VBIMeasure\n  }\n}\n","import * as Y from 'yjs'\nimport type { ObserveCallback, VBIMeasure, VBIMeasureGroup, VBIMeasureTree } from 'src/types'\nimport { MeasureNodeBuilder } from './measure-node-builder'\n\nexport class MeasuresBuilder {\n  private dsl: Y.Map<any>\n  private doc: Y.Doc\n  constructor(doc: Y.Doc, dsl: Y.Map<any>) {\n    this.doc = doc\n    this.dsl = dsl\n  }\n\n  addMeasure(fieldOrMeasure: VBIMeasure['field'] | VBIMeasure): MeasureNodeBuilder\n  addMeasure(\n    fieldOrMeasure: VBIMeasure['field'] | VBIMeasure,\n    callback: (measureNode: MeasureNodeBuilder) => void,\n  ): MeasuresBuilder\n  addMeasure(\n    fieldOrMeasure: VBIMeasure['field'] | VBIMeasure,\n    callback?: (measureNode: MeasureNodeBuilder) => void,\n  ): MeasureNodeBuilder | MeasuresBuilder {\n    const defaultMeasure: VBIMeasure = {} as VBIMeasure\n    if (typeof fieldOrMeasure === 'string') {\n      defaultMeasure.alias = fieldOrMeasure\n      defaultMeasure.field = fieldOrMeasure\n      defaultMeasure.encoding = 'yAxis'\n      defaultMeasure.aggregate = { func: 'sum' }\n    } else {\n      defaultMeasure.alias = fieldOrMeasure.alias\n      defaultMeasure.field = fieldOrMeasure.field\n      defaultMeasure.encoding = fieldOrMeasure.encoding\n      defaultMeasure.aggregate = fieldOrMeasure.aggregate\n    }\n\n    const yMap = new Y.Map<any>()\n\n    for (const [key, value] of Object.entries(defaultMeasure)) {\n      yMap.set(key, value)\n    }\n    this.dsl.get('measures').push([yMap])\n\n    const measureNode = new MeasureNodeBuilder(yMap)\n\n    if (callback) {\n      callback(measureNode)\n      return this\n    } else {\n      return measureNode\n    }\n  }\n\n  removeMeasure(field: VBIMeasure['field']) {\n    const measures = this.dsl.get('measures')\n    const index = measures.toArray().findIndex((item: any) => item.get('field') === field)\n    if (index !== -1) {\n      this.dsl.get('measures').delete(index, 1)\n    }\n  }\n\n  getMeasures(): VBIMeasure[] {\n    return this.dsl.get('measures').toJSON()\n  }\n\n  observe(callback: ObserveCallback) {\n    this.dsl.get('measures').observe(callback)\n  }\n\n  unobserve(callback: ObserveCallback) {\n    this.dsl.get('measures').unobserve(callback)\n  }\n\n  static isMeasureNode(node: VBIMeasureTree[0]): node is VBIMeasure {\n    return 'field' in node\n  }\n\n  static isMeasureGroup(node: VBIMeasureTree[0]): node is VBIMeasureGroup {\n    return 'children' in node\n  }\n}\n","import type { Select, VQueryDSL } from '@visactor/vquery'\nimport { VBIDSL } from '../../types'\nimport { DimensionsBuilder, MeasuresBuilder, VBIBuilder } from 'src'\nimport { pipe } from 'remeda'\n\ntype buildPipe = (queryDSL: VQueryDSL, context: { vbiDSL: VBIDSL; builder: VBIBuilder }) => VQueryDSL\n\nexport const buildVQuery = (vbiDSL: VBIDSL, builder: VBIBuilder) => {\n  const wrapper = (processor: (queryDSL: VQueryDSL, context: { vbiDSL: VBIDSL; builder: VBIBuilder }) => VQueryDSL) => {\n    return (queryDSL: VQueryDSL): VQueryDSL => processor(queryDSL, { vbiDSL, builder })\n  }\n\n  return pipe({} as VQueryDSL, wrapper(buildSelect), wrapper(buildGroupBy), wrapper(buildLimit))\n}\n\nconst buildSelect: buildPipe = (queryDSL, context) => {\n  const { vbiDSL } = context\n  const measures = vbiDSL.measures\n  const dimensions = vbiDSL.dimensions\n\n  const result = { ...queryDSL }\n  const measureNodes = measures.filter((measure) => MeasuresBuilder.isMeasureNode(measure))\n  const measureSelects: Select<Record<string, unknown>> = measureNodes.map((measure) => {\n    return {\n      field: measure.field,\n      alias: measure.alias,\n      func: measure.aggregate.func,\n    }\n  })\n\n  const dimensionNodes = dimensions.filter((dimension) => DimensionsBuilder.isDimensionNode(dimension))\n  const dimensionSelects: Select<Record<string, unknown>> = dimensionNodes.map((dimension) => {\n    return {\n      field: dimension.field,\n      alias: dimension.alias,\n    }\n  })\n\n  result.select = measureSelects.concat(dimensionSelects)\n\n  return result as VQueryDSL\n}\n\nconst buildGroupBy: buildPipe = (queryDSL, context) => {\n  const result = { ...queryDSL }\n  const { vbiDSL } = context\n\n  const dimensions = vbiDSL.dimensions\n  const dimensionNodes = dimensions.filter((dimension) => DimensionsBuilder.isDimensionNode(dimension))\n\n  result.groupBy = dimensionNodes.map((dimension) => dimension.field)\n  return result as VQueryDSL\n}\n\nconst buildLimit: buildPipe = (queryDSL) => {\n  const result = { ...queryDSL }\n\n  result.limit = 1000\n\n  return result as VQueryDSL\n}\n","import { ChartTypeEnum } from '@visactor/vseed'\nimport { ObserveCallback } from 'src/types'\nimport * as Y from 'yjs'\n\nexport class ChartTypeBuilder {\n  private dsl: Y.Map<any>\n  constructor(doc: Y.Doc, dsl: Y.Map<any>) {\n    this.dsl = dsl\n  }\n\n  observe(callback: ObserveCallback) {\n    const wrapper: ObserveCallback = (e, trans) => {\n      if (e.keysChanged.has('chartType')) {\n        callback(e, trans)\n      }\n    }\n    this.dsl.observe(wrapper)\n  }\n\n  unobserve(callback: ObserveCallback) {\n    const wrapper: ObserveCallback = (e, trans) => {\n      if (e.keysChanged.has('chartType')) {\n        callback(e, trans)\n      }\n    }\n    this.dsl.unobserve(wrapper)\n  }\n\n  changeChartType(chartType: string) {\n    this.dsl.set('chartType', chartType)\n  }\n\n  getChartType() {\n    return this.dsl.get('chartType') || 'table'\n  }\n\n  getAvailableChartTypes(): string[] {\n    return [\n      // Table\n      ChartTypeEnum.Table,\n      ChartTypeEnum.PivotTable,\n      // cartesian\n      ChartTypeEnum.Line,\n      ChartTypeEnum.Column,\n      ChartTypeEnum.ColumnPercent,\n      ChartTypeEnum.ColumnParallel,\n      ChartTypeEnum.BarPercent,\n      ChartTypeEnum.BarParallel,\n      ChartTypeEnum.Area,\n      ChartTypeEnum.AreaPercent,\n      ChartTypeEnum.DualAxis,\n      ChartTypeEnum.Scatter,\n      // Polar\n      ChartTypeEnum.Rose,\n      ChartTypeEnum.RoseParallel,\n      ChartTypeEnum.Pie,\n      ChartTypeEnum.Donut,\n      ChartTypeEnum.Radar,\n      // Other\n      ChartTypeEnum.Funnel,\n      ChartTypeEnum.Heatmap,\n      ChartTypeEnum.Boxplot,\n      ChartTypeEnum.Histogram,\n    ]\n  }\n}\n","import { VBIConnector, VBIConnectorId } from 'src/types/connector/connector'\n\nexport const connectorMap: Map<VBIConnectorId, VBIConnector | (() => Promise<VBIConnector>)> = new Map()\n\nexport const registerConnector = (id: VBIConnectorId, connector: VBIConnector | (() => Promise<VBIConnector>)) => {\n  connectorMap.set(id, connector)\n}\n\nexport const getConnector = async (id: VBIConnectorId) => {\n  const connector = connectorMap.get(id)\n  if (!connector) {\n    throw new Error(`connector ${id} not registered`)\n  }\n  if (typeof connector === 'function') {\n    return connector()\n  }\n  return connector\n}\n","import * as Y from 'yjs'\n\nimport { VSeedDSL } from '@visactor/vseed'\nimport { DimensionsBuilder } from './sub-builders/dimensions'\nimport { MeasuresBuilder } from './sub-builders/measures'\nimport { VBIDSL, VBIBuilderInterface } from 'src/types'\nimport { buildVQuery } from 'src/pipeline'\nimport { ChartTypeBuilder } from './sub-builders/chart-type'\nimport { getConnector } from './connector'\nimport { VQueryDSL } from '@visactor/vquery'\n\nexport class VBIBuilder implements VBIBuilderInterface {\n  public doc: Y.Doc\n  public dsl: Y.Map<any>\n  public undoManager: Y.UndoManager\n\n  public chartType: ChartTypeBuilder\n  public measures: MeasuresBuilder\n  public dimensions: DimensionsBuilder\n\n  constructor(doc: Y.Doc) {\n    this.doc = doc\n    this.dsl = doc.getMap('dsl') as Y.Map<any>\n\n    this.undoManager = new Y.UndoManager(this.dsl)\n    this.chartType = new ChartTypeBuilder(doc, this.dsl)\n    this.measures = new MeasuresBuilder(doc, this.dsl)\n    this.dimensions = new DimensionsBuilder(doc, this.dsl)\n  }\n\n  public applyUpdate(update: Uint8Array) {\n    Y.applyUpdate(this.doc, update)\n  }\n\n  public encodeStateAsUpdate(targetStateVector?: Uint8Array) {\n    return Y.encodeStateAsUpdate(this.doc, targetStateVector)\n  }\n\n  public buildVSeed = async (): Promise<VSeedDSL> => {\n    const vbiDSL = this.build()\n    const connectorId = vbiDSL.connectorId\n    const connector = await getConnector(vbiDSL.connectorId)\n\n    const queryDSL = this.buildVQuery()\n    const schema = await connector.discoverSchema()\n    const queryResult = await connector.query({ queryDSL, schema, connectorId })\n\n    return {\n      chartType: vbiDSL.chartType,\n      dataset: queryResult.dataset,\n    } as VSeedDSL\n  }\n\n  public buildVQuery = (): VQueryDSL => {\n    const vbiDSL = this.build()\n    return buildVQuery(vbiDSL, this)\n  }\n\n  public build = (): VBIDSL => {\n    return this.dsl.toJSON() as VBIDSL\n  }\n\n  public getSchema = async () => {\n    const connectorId = this.dsl.get('connectorId')\n    const con = await getConnector(connectorId)\n    const result = await con.discoverSchema()\n    return result\n  }\n}\n","import { VBIConnectorId } from 'src/types/connector/connector'\nimport { VBIDSL } from 'src/types'\nimport { VBIBuilder } from './vbi-builder'\nimport { connectorMap, getConnector, registerConnector } from './connector'\n\nimport * as Y from 'yjs'\n\nconst createVBI = () => {\n  return {\n    connectorMap: connectorMap,\n    registerConnector: registerConnector,\n    getConnector: getConnector,\n    generateEmptyDSL: (connectorId: VBIConnectorId): VBIDSL => {\n      return {\n        connectorId: connectorId,\n        chartType: 'table',\n        measures: [],\n        dimensions: [],\n        theme: 'light',\n        locale: 'zh-CN',\n        version: 0,\n      }\n    },\n    from: (vbi: VBIDSL) => {\n      const doc = new Y.Doc()\n      const dsl = doc.getMap('dsl')\n\n      doc.transact(() => {\n        if (vbi.connectorId) dsl.set('connectorId', vbi.connectorId)\n        if (vbi.chartType) dsl.set('chartType', vbi.chartType)\n        if (vbi.theme) dsl.set('theme', vbi.theme)\n        if (vbi.locale) dsl.set('locale', vbi.locale)\n        if (vbi.version) dsl.set('version', vbi.version)\n\n        if (!dsl.get('measures')) {\n          dsl.set('measures', new Y.Array<any>())\n        } else {\n          dsl.set('measures', vbi.measures)\n        }\n\n        if (!dsl.get('dimensions')) {\n          dsl.set('dimensions', new Y.Array<any>())\n        } else {\n          dsl.set('dimensions', vbi.dimensions)\n        }\n      })\n\n      return new VBIBuilder(doc)\n    },\n  }\n}\n\nexport const VBI = createVBI()\n","import { InsightType, TidyData, VInsightDSL, VInsightResult, InsightInfoItem } from './types'\nimport { median, medianAbsoluteDeviation, mean, standardDeviation } from 'simple-statistics'\n\nconst zScoreMad = (dataset: TidyData, insightDSL: VInsightDSL): VInsightResult => {\n  if (insightDSL.insightType !== 'zScoreMad') return { dataset, insightInfo: [] }\n  const { measures, threshold = 2.5 } = insightDSL\n  const stats: Record<string, { median: number; mad: number }> = {}\n  for (const field of measures) {\n    const values = dataset.map((d) => d[field]).filter((v): v is number => typeof v === 'number' && Number.isFinite(v))\n    const m = values.length ? median(values) : 0\n    const mad = values.length ? medianAbsoluteDeviation(values) : 0\n    stats[field] = { median: m, mad }\n  }\n  const out = dataset.map((d) => {\n    const nd: Record<string, unknown> = { ...d }\n    for (const field of measures) {\n      const v = d[field]\n      const sKey = `${field}_score`\n      const aKey = `${field}_isAnomaly`\n      let z = 0\n      if (typeof v === 'number' && Number.isFinite(v)) {\n        const m = stats[field].median\n        const mad = stats[field].mad\n        z = mad === 0 ? 0 : (0.6745 * (v - m)) / mad\n      }\n      nd[sKey] = z\n      nd[aKey] = Math.abs(z) >= threshold\n    }\n    return nd\n  }) as TidyData\n  const insightInfo: InsightInfoItem[] = measures.map((field) => ({\n    field,\n    scoreField: `${field}_score`,\n    isAnomalyField: `${field}_isAnomaly`,\n    algorithm: 'zScoreMad',\n    params: {\n      threshold,\n      median: stats[field]?.median ?? 0,\n      mad: stats[field]?.mad ?? 0,\n    },\n  }))\n  return { dataset: out, insightInfo }\n}\n\nconst zScoreRolling = (dataset: TidyData, insightDSL: VInsightDSL): VInsightResult => {\n  if (insightDSL.insightType !== 'zScoreRolling') return { dataset, insightInfo: [] }\n  const { valueField, window, outputField, timeField, threshold } = insightDSL.schema\n  const base = outputField ?? valueField\n  const out = dataset.map((d, i) => {\n    const nd: Record<string, unknown> = { ...d }\n    const prev: number[] = []\n    const start = Math.max(0, i - window)\n    for (let k = start; k < i; k++) {\n      const vv = dataset[k][valueField]\n      if (typeof vv === 'number' && Number.isFinite(vv)) prev.push(vv)\n    }\n    const v = d[valueField]\n    let z = 0\n    if (typeof v === 'number' && Number.isFinite(v) && prev.length >= 2) {\n      const m = mean(prev)\n      const sd = standardDeviation(prev)\n      z = sd === 0 ? 0 : (v - m) / sd\n    }\n    nd[`${base}_score`] = z\n    nd[`${base}_isAnomaly`] = Math.abs(z) >= threshold\n    return nd\n  }) as TidyData\n  const insightInfo: InsightInfoItem[] = [\n    {\n      field: base,\n      scoreField: `${base}_score`,\n      isAnomalyField: `${base}_isAnomaly`,\n      algorithm: 'zScoreRolling',\n      params: { window, threshold, valueField, outputField: base, timeField: timeField ?? null },\n    },\n  ]\n  return { dataset: out, insightInfo }\n}\n\nconst insightMap: Record<InsightType, (dataset: TidyData, insightDSL: VInsightDSL) => VInsightResult> = {\n  zScoreMad: zScoreMad,\n  zScoreRolling: zScoreRolling,\n}\n\nexport function quickInsight(dataset: TidyData, insightDSL: VInsightDSL): VInsightResult {\n  const insightFn = insightMap[insightDSL.insightType]\n  if (insightFn) {\n    return insightFn(dataset, insightDSL)\n  }\n  return { dataset, insightInfo: [] }\n}\n","import { Dialect, DummyDriver } from 'kysely'\nimport { PostgresQueryCompiler } from 'kysely'\nimport { PostgresAdapter } from 'kysely'\nimport { Kysely } from 'kysely'\nimport type {\n  DatabaseIntrospector,\n  SchemaMetadata,\n  TableMetadata,\n  DatabaseMetadata,\n  DatabaseMetadataOptions,\n} from 'kysely'\n\nexport class PostgresDialect implements Dialect {\n  createDriver() {\n    return new DummyDriver()\n  }\n  createQueryCompiler() {\n    return new PostgresQueryCompiler()\n  }\n  createAdapter() {\n    return new PostgresAdapter()\n  }\n  createIntrospector<DB = unknown>(db: Kysely<DB>): DatabaseIntrospector {\n    void db\n    class NullIntrospector implements DatabaseIntrospector {\n      async getSchemas(): Promise<SchemaMetadata[]> {\n        return []\n      }\n      async getTables(options?: DatabaseMetadataOptions): Promise<TableMetadata[]> {\n        void options?.withInternalKyselyTables\n        return []\n      }\n      async getMetadata(options?: DatabaseMetadataOptions): Promise<DatabaseMetadata> {\n        void options?.withInternalKyselyTables\n        return { tables: [] }\n      }\n    }\n    return new NullIntrospector()\n  }\n}\n","import { Where, WhereClause, WhereGroup, WhereLeaf } from 'src/types'\nimport { SelectItem } from 'src/types/dsl/Select'\n\nexport const isSelectItem = <T>(item: keyof T | SelectItem<T>): item is SelectItem<T> => {\n  return typeof item === 'object' && 'field' in item\n}\n\nexport const isWhereLeaf = <T>(where: Where<T> | WhereClause<T>): where is WhereLeaf<T> => {\n  return 'field' in where && 'op' in where && 'value' in where\n}\n\nexport const isWhereGroup = <T>(where: Where<T> | WhereClause<T>): where is WhereGroup<T> => {\n  return 'op' in where && 'conditions' in where\n}\n\nexport const isStringOrNumber = (value: unknown): value is string | number => {\n  return typeof value === 'string' || typeof value === 'number'\n}\n\nexport const escapeLiteral = <T>(value: T[keyof T]): T[keyof T] => {\n  if (typeof value === 'string') {\n    return `'${value.replace(/'/g, \"''\")}'` as unknown as T[keyof T]\n  }\n  return value\n}\n\nexport const escapeValue = (value: unknown): string => {\n  if (value === null) return 'null'\n  if (typeof value === 'string') return `'${value.replace(/'/g, \"''\")}'`\n  if (typeof value === 'number') return `${value}`\n  if (typeof value === 'boolean') return value ? 'TRUE' : 'FALSE'\n  return `'${String(value).replace(/'/g, \"''\")}'`\n}\n","import { QueryDSL } from 'src/types'\nimport { Kysely } from 'kysely'\nimport { PostgresDialect } from './dialect'\nimport { inlineParameters } from './compile'\nimport { applyWhere, applyGroupBy, applyLimit } from './builders'\nimport { isSelectItem } from './utils'\n\ntype TableDB<TableName extends string, Row> = {\n  [K in TableName]: Row\n}\n\nexport const convertDSLToSQL = <T, TableName extends string>(dsl: QueryDSL<T>, tableName: TableName): string => {\n  const db = new Kysely<TableDB<TableName, T>>({ dialect: new PostgresDialect() })\n\n  let qb = db.selectFrom(tableName)\n\n  if (dsl.select && dsl.select.length > 0) {\n    qb = qb.select((eb) =>\n      dsl.select.map((item) => {\n        if (isSelectItem(item)) {\n          const field = item.field as Extract<keyof T, string>\n          if (item.func) {\n            const alias = item.alias ?? (field as string)\n            switch (item.func) {\n              case 'avg':\n                return eb.fn.avg(field).as(alias)\n              case 'sum':\n                return eb.fn.sum(field).as(alias)\n              case 'min':\n                return eb.fn.min(field).as(alias)\n              case 'max':\n                return eb.fn.max(field).as(alias)\n              case 'count':\n                return eb.fn.count(field).as(alias)\n            }\n          }\n          return item.alias ? eb.ref(field).as(item.alias) : field\n        }\n        return item as Extract<keyof T, string>\n      }),\n    )\n  } else {\n    qb = qb.selectAll()\n  }\n\n  if (dsl.where) {\n    qb = qb.where(applyWhere<T>(dsl.where))\n  }\n\n  qb = applyGroupBy(qb, dsl.groupBy as Array<Extract<keyof T, string>> | undefined)\n\n  if (dsl.orderBy && dsl.orderBy.length > 0) {\n    for (const o of dsl.orderBy) {\n      qb = qb.orderBy(o.field as Extract<keyof T, string>, (o.order ?? 'asc') as 'asc' | 'desc')\n    }\n  }\n\n  qb = applyLimit(qb, dsl.limit)\n\n  const compiled = qb.compile()\n  return inlineParameters(compiled.sql, compiled.parameters)\n}\n","import { Where, WhereClause } from 'src/types'\nimport { sql } from 'kysely'\nimport type { RawBuilder } from 'kysely'\n\nexport const applyWhere = <T>(where: Where<T> | WhereClause<T>): RawBuilder<boolean> => {\n  const toRaw = (w: Where<T> | WhereClause<T>): RawBuilder<boolean> => {\n    if ('op' in w && 'conditions' in w) {\n      const parts: RawBuilder<boolean>[] = (w.conditions as Array<WhereClause<T>>).map((c) => toRaw(c))\n      const sep: RawBuilder<unknown> = sql` ${sql.raw(w.op)} `\n      return sql<boolean>`(${sql.join(parts, sep)})`\n    }\n    const leaf = w as unknown as { field: Extract<keyof T, string>; op: string; value?: unknown }\n    const field = leaf.field\n    const value = leaf.value\n    switch (leaf.op) {\n      case 'is null':\n        return sql<boolean>`${sql.ref(field)} is null`\n      case 'is not null':\n        return sql<boolean>`${sql.ref(field)} is not null`\n      case 'in': {\n        const items = Array.isArray(value) ? (value as unknown[]) : [value]\n        return sql<boolean>`${sql.ref(field)} in (${sql.join(items.map((v) => sql.val(v)))})`\n      }\n      case 'not in': {\n        const items = Array.isArray(value) ? (value as unknown[]) : [value]\n        return sql<boolean>`not ${sql.ref(field)} in (${sql.join(items.map((v) => sql.val(v)))})`\n      }\n      case 'between': {\n        const [a, b] = value as [unknown, unknown]\n        return sql<boolean>`${sql.ref(field)} between (${sql.val(a)}, ${sql.val(b)})`\n      }\n      case 'not between': {\n        const [a, b] = value as [unknown, unknown]\n        return sql<boolean>`not ${sql.ref(field)} between (${sql.val(a)}, ${sql.val(b)})`\n      }\n      default:\n        return sql<boolean>`${sql.ref(field)} ${sql.raw(leaf.op)} ${sql.val(value)}`\n    }\n  }\n  return toRaw(where)\n}\n","import type { SelectQueryBuilder } from 'kysely'\n\nexport const applyLimit = <DB, TB extends keyof DB & string, O>(qb: SelectQueryBuilder<DB, TB, O>, limit?: number) => {\n  if (limit && typeof limit === 'number') {\n    qb = qb.limit(limit)\n  }\n  return qb\n}\n","import { sql } from 'kysely'\nimport type { SelectQueryBuilder } from 'kysely'\n\nexport const applyGroupBy = <DB, TB extends keyof DB & string, O>(\n  qb: SelectQueryBuilder<DB, TB, O>,\n  fields?: Array<string>,\n) => {\n  if (fields && fields.length > 0) {\n    const exprs = fields.map((f) => sql.id(f))\n    type GroupByParam = Parameters<SelectQueryBuilder<DB, TB, O>['groupBy']>[0]\n    qb = qb.groupBy(exprs as GroupByParam)\n  }\n  return qb\n}\n","import { escapeValue } from '../utils'\n\nexport const inlineParameters = (sql: string, params: readonly unknown[]): string => {\n  if (params.length === 0) return sql\n  if (sql.includes('?')) {\n    let out = sql\n    for (const p of params) {\n      out = out.replace(/\\?/, escapeValue(p))\n    }\n    return out\n  }\n  if (/\\$\\d+/.test(sql)) {\n    return sql.replace(/\\$(\\d+)/g, (_, idx) => {\n      const i = Number(idx) - 1\n      const v = params[i]\n      return escapeValue(v)\n    })\n  }\n  return sql\n}\n","export const isUrl = (url: string) => {\n  return isHttpUrl(url) || isBase64Url(url)\n}\nexport const isHttpUrl = (url: string) => {\n  return url.startsWith('http://') || url.startsWith('https://')\n}\n\nexport const isBase64Url = (url: string) => {\n  return url.startsWith('data:')\n}\n","import { isUrl } from 'src/utils'\nimport { DatasetSourceType, DatasetSourceValue, RawDatasetSource, TidyDatum } from '../types'\n\nexport class DatasetSourceBuilder {\n  private type: DatasetSourceType\n  private value: DatasetSourceValue\n\n  constructor(raw: RawDatasetSource) {\n    this.type = raw.type\n    this.value = raw.rawDataset\n  }\n\n  public static from(raw: RawDatasetSource): DatasetSourceBuilder {\n    return new DatasetSourceBuilder(raw)\n  }\n\n  public async build() {\n    const blob = await DatasetSourceBuilder.convertToBlob(this.type, this.value)\n\n    return {\n      type: this.type,\n      blob: blob,\n    }\n  }\n\n  /**\n   * 将不同类型的数据转换为Blob\n   */\n  private static async convertToBlob(type: DatasetSourceType, value: DatasetSourceValue): Promise<Blob> {\n    if (value instanceof Blob) {\n      return value\n    }\n    const convertCsvToBlob = (csvSource: string | ArrayBuffer | TidyDatum[]) => {\n      if (csvSource instanceof ArrayBuffer) {\n        return new Blob([csvSource], { type: 'text/csv' })\n      }\n      if (typeof csvSource === 'string' && isUrl(csvSource)) {\n        return DatasetSourceBuilder.fetchBlob(csvSource)\n      }\n      return new Blob([JSON.stringify(csvSource)], { type: 'text/csv' })\n    }\n    const convertJsonToBlob = (jsonSource: string | ArrayBuffer | TidyDatum[]) => {\n      if (jsonSource instanceof ArrayBuffer) {\n        return new Blob([jsonSource], { type: 'application/json' })\n      }\n      if (typeof jsonSource === 'string' && isUrl(jsonSource)) {\n        return DatasetSourceBuilder.fetchBlob(jsonSource)\n      }\n      return new Blob([JSON.stringify(jsonSource)], { type: 'application/json' })\n    }\n    const convertParquetToBlob = (parquetSource: string | ArrayBuffer) => {\n      if (parquetSource instanceof ArrayBuffer) {\n        return new Blob([parquetSource], { type: 'application/parquet' })\n      }\n      if (typeof parquetSource === 'string' && isUrl(parquetSource)) {\n        return DatasetSourceBuilder.fetchBlob(parquetSource)\n      }\n      return new Blob([parquetSource], { type: 'application/parquet' })\n    }\n    const convertXlsxToBlob = (xlsxSource: string | ArrayBuffer) => {\n      if (xlsxSource instanceof ArrayBuffer) {\n        return new Blob([xlsxSource], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n      }\n      if (typeof xlsxSource === 'string' && isUrl(xlsxSource)) {\n        return DatasetSourceBuilder.fetchBlob(xlsxSource)\n      }\n      return new Blob([xlsxSource], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n    }\n\n    switch (type) {\n      case 'csv': {\n        return convertCsvToBlob(value as string)\n      }\n      case 'json': {\n        return convertJsonToBlob(value as string)\n      }\n      case 'xlsx': {\n        return convertXlsxToBlob(value as string)\n      }\n      case 'parquet': {\n        return convertParquetToBlob(value as string)\n      }\n      default: {\n        return new Blob([value as unknown as string])\n      }\n    }\n  }\n\n  private static async fetchBlob(url: string) {\n    const response = await fetch(url)\n    return await response.blob()\n  }\n}\n","import { DatasetSource, StorageAdapter } from 'src/types'\nimport { DatasetSchema } from '../../types/DataSet'\n\nexport class IndexedDBAdapter implements StorageAdapter {\n  private db: IDBDatabase | null = null\n  private dbName: string\n  private datasetStoreName = 'vqueryDatasets'\n\n  constructor(dbName: string = 'vquery') {\n    this.dbName = dbName\n  }\n\n  public open = (): Promise<void> => {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, 2)\n\n      request.onupgradeneeded = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result\n        // 创建数据集存储\n        if (!db.objectStoreNames.contains(this.datasetStoreName)) {\n          db.createObjectStore(this.datasetStoreName, { keyPath: 'datasetId' })\n        }\n      }\n\n      request.onsuccess = (event) => {\n        this.db = (event.target as IDBOpenDBRequest).result\n        resolve()\n      }\n\n      request.onerror = (event) => {\n        reject((event.target as IDBOpenDBRequest).error)\n      }\n    })\n  }\n\n  public close = async (): Promise<void> => {\n    if (this.db) {\n      this.db.close()\n      this.db = null\n    }\n  }\n\n  public writeDataset = (\n    datasetId: string,\n    datasetSchema: DatasetSchema,\n    datasetSource?: DatasetSource,\n  ): Promise<void> => {\n    return new Promise((resolve, reject) => {\n      if (!this.db) {\n        return reject('DB is not open')\n      }\n      const transaction = this.db.transaction([this.datasetStoreName], 'readwrite')\n      const store = transaction.objectStore(this.datasetStoreName)\n      const request = store.put({ datasetId, datasetSchema, datasetSource })\n\n      request.onsuccess = () => {\n        resolve()\n      }\n\n      request.onerror = (event) => {\n        reject((event.target as IDBRequest).error)\n      }\n    })\n  }\n\n  public readDataset = (\n    datasetId: string,\n  ): Promise<{ datasetSource?: DatasetSource; datasetSchema: DatasetSchema } | null> => {\n    return new Promise((resolve, reject) => {\n      if (!this.db) {\n        return reject('DB is not open')\n      }\n      const transaction = this.db.transaction([this.datasetStoreName], 'readonly')\n      const store = transaction.objectStore(this.datasetStoreName)\n      const request = store.get(datasetId)\n\n      request.onsuccess = (event) => {\n        const result = (event.target as IDBRequest).result as\n          | { dataSource?: DatasetSource; datasetSchema: DatasetSchema }\n          | undefined\n        resolve(result || null)\n      }\n\n      request.onerror = (event) => {\n        reject((event.target as IDBRequest).error)\n      }\n    })\n  }\n\n  public deleteDataset = (datasetId: string): Promise<void> => {\n    return new Promise((resolve, reject) => {\n      if (!this.db) {\n        return reject('DB is not open')\n      }\n      const transaction = this.db.transaction([this.datasetStoreName], 'readwrite')\n      const store = transaction.objectStore(this.datasetStoreName)\n      const request = store.delete(datasetId)\n\n      request.onsuccess = () => {\n        resolve()\n      }\n\n      request.onerror = (event) => {\n        reject((event.target as IDBRequest).error)\n      }\n    })\n  }\n\n  public listDatasets = (): Promise<\n    { datasetId: string; dataSource?: DatasetSource; datasetSchema: DatasetSchema }[]\n  > => {\n    return new Promise((resolve, reject) => {\n      if (!this.db) {\n        return reject('DB is not open')\n      }\n      const transaction = this.db.transaction([this.datasetStoreName], 'readonly')\n      const store = transaction.objectStore(this.datasetStoreName)\n      const request = store.getAll()\n\n      request.onsuccess = (event) => {\n        const result = (event.target as IDBRequest).result as {\n          datasetId: string\n          dataSource?: DatasetSource\n          datasetSchema: DatasetSchema\n        }[]\n        resolve(result)\n      }\n\n      request.onerror = (event) => {\n        reject((event.target as IDBRequest).error)\n      }\n    })\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { DuckDBBundles, AsyncDuckDBConnection } from '@duckdb/duckdb-wasm'\nimport { AsyncDuckDB, selectBundle, ConsoleLogger } from '@duckdb/duckdb-wasm'\nimport { QueryAdapter } from 'src/types'\nimport { QueryResult } from 'src/types/DataSet'\n\nexport class DuckDBWebQueryAdapter implements QueryAdapter {\n  private db: AsyncDuckDB | null = null\n  private connection: AsyncDuckDBConnection | null = null\n\n  constructor() {}\n\n  open = async () => {\n    const MANUAL_BUNDLES: DuckDBBundles = {\n      mvp: {\n        mainModule: new URL('@duckdb/duckdb-wasm/dist/duckdb-mvp.wasm', import.meta.url).href,\n        mainWorker: new URL('@duckdb/duckdb-wasm/dist/duckdb-browser-mvp.worker.js', import.meta.url).toString(),\n      },\n      eh: {\n        mainModule: new URL('@duckdb/duckdb-wasm/dist/duckdb-eh.wasm', import.meta.url).href,\n        mainWorker: new URL('@duckdb/duckdb-wasm/dist/duckdb-browser-eh.worker.js', import.meta.url).toString(),\n      },\n    }\n\n    const bundle = await selectBundle(MANUAL_BUNDLES)\n    const worker_url = URL.createObjectURL(\n      new Blob([`importScripts(\"${bundle.mainWorker!}\");`], { type: 'text/javascript' }),\n    )\n    const worker = new Worker(worker_url)\n    const logger = new ConsoleLogger()\n\n    this.db = new AsyncDuckDB(logger, worker)\n    await this.db.instantiate(bundle.mainModule, bundle.pthreadWorker)\n    URL.revokeObjectURL(worker_url)\n\n    this.connection = await this.db.connect()\n  }\n\n  close = async () => {\n    if (this.connection) {\n      await this.connection.close()\n      this.connection = null\n    }\n    if (this.db) {\n      await this.db.terminate()\n      this.db = null\n    }\n  }\n\n  writeFile = async <T extends Blob>(fileName: string, source: T) => {\n    if (!this.db) {\n      throw new Error('db is null')\n    }\n    let uint8Array: Uint8Array\n\n    if (source instanceof Blob) {\n      // blob object\n      const buffer = await source.arrayBuffer()\n      uint8Array = new Uint8Array(buffer)\n    } else {\n      throw new Error('Unsupported source type')\n    }\n\n    await this.db.registerFileBuffer(fileName, uint8Array)\n  }\n\n  query = async (sql: string) => {\n    if (!this.connection) {\n      throw new Error('connection is null')\n    }\n    const table = await this.connection.query(sql)\n    const dataset = table.toArray().map((row) => row.toJSON())\n    return {\n      dataset,\n      table,\n    } as { dataset: any[]; table: any }\n  }\n\n  getSchema = async (fileName: string) => {\n    if (!this.connection) {\n      throw new Error('connection is null')\n    }\n\n    const result = await this.connection.query(`PRAGMA table_info('${fileName}')`)\n    return result.toArray().map((row) => row.toJSON()) as QueryResult\n  }\n}\n","import { DatasetColumn, DatasetSource, DatasetSourceType, DataType, QueryDSL } from 'src/types'\nimport { QueryAdapter, StorageAdapter } from 'src/types'\nimport { convertDSLToSQL } from 'src/sql-builder'\n\nexport class Dataset {\n  private queryAdapter: QueryAdapter\n  private storageAdapter: StorageAdapter\n  private _datasetId: string\n\n  constructor(duckDB: QueryAdapter, indexedDB: StorageAdapter, datasetId: string) {\n    this.queryAdapter = duckDB\n    this.storageAdapter = indexedDB\n    this._datasetId = datasetId\n  }\n\n  public async init(temporaryColumns?: DatasetColumn[], temporaryDatasetSource?: DatasetSource) {\n    const datasetInfo = await this.storageAdapter.readDataset(this._datasetId)\n    if (!datasetInfo) {\n      throw new Error(`Dataset ${this._datasetId} not found`)\n    }\n\n    const columns = temporaryColumns ? temporaryColumns : datasetInfo.datasetSchema.columns\n    const datasetSource = temporaryDatasetSource || datasetInfo.datasetSource\n    if (columns.length > 0 && datasetSource) {\n      await this.createOrReplaceView(columns, datasetSource)\n    }\n  }\n\n  public async createOrReplaceView(columns: DatasetColumn[], datasetSource: DatasetSource) {\n    const readFunctionMap: Record<DatasetSourceType, string> = {\n      csv: 'read_csv_auto',\n      json: 'read_json_auto',\n      xlsx: 'read_excel',\n      parquet: 'read_parquet',\n    }\n\n    const dataTypeMap: Record<DataType, string> = {\n      number: 'DOUBLE',\n      string: 'VARCHAR',\n      date: 'DATE',\n      datetime: 'TIMESTAMP',\n      timestamp: 'TIMESTAMP',\n    }\n\n    if (datasetSource) {\n      const readFunction = readFunctionMap[datasetSource.type]\n      if (!readFunction) {\n        throw new Error(`Unsupported dataSource type: ${datasetSource.type}`)\n      }\n\n      // 注册文件到DuckDB - 只处理文件类型，不处理数组\n      await this.queryAdapter.writeFile(this._datasetId, datasetSource.blob)\n\n      const columnsStruct = `{${columns.map((c) => `'${c.name}': '${dataTypeMap[c.type] || 'VARCHAR'}'`).join(', ')}}`\n      const columnNames = columns.map((c) => `\"${c.name}\"`).join(', ')\n\n      // 创建视图\n      const createViewSql = `CREATE OR REPLACE VIEW \"${this._datasetId}\" AS SELECT ${columnNames} FROM ${readFunction}('${this._datasetId}', columns=${columnsStruct})`\n      await this.queryAdapter.query(createViewSql)\n    }\n  }\n\n  public async query<T extends Record<string, number | string>>(queryDSL: QueryDSL<T>) {\n    const sql = convertDSLToSQL(queryDSL, this.datasetId)\n    return this.queryBySQL(sql)\n  }\n\n  public async queryBySQL(sql: string) {\n    const start = performance?.now?.()?.toFixed(3) ?? Date.now().toFixed(3)\n    const result = await this.queryAdapter.query(sql)\n    const end = performance?.now?.()?.toFixed(3) ?? Date.now().toFixed(3)\n    return {\n      ...result,\n      performance: {\n        startAt: start,\n        endAt: end,\n        duration: Number(end) - Number(start),\n      },\n    }\n  }\n\n  public async disconnect() {\n    await this.queryAdapter.query(`DROP VIEW IF EXISTS \"${this._datasetId}\"`)\n  }\n\n  get datasetId() {\n    return this._datasetId\n  }\n}\n","import { IndexedDBAdapter } from './adapters'\nimport { DuckDBWebQueryAdapter } from './adapters/query-adapter/duckdbWebAdapter'\nimport { Dataset } from './dataset/dataset'\nimport { RawDatasetSource, DatasetColumn, QueryAdapter, StorageAdapter } from './types'\nimport { DatasetSourceBuilder } from 'src/data-source-builder'\n\nexport class VQuery {\n  private queryAdapter: QueryAdapter\n  private storageAdapter: StorageAdapter\n  private isInitialized: boolean = false\n\n  constructor() {\n    this.queryAdapter = new DuckDBWebQueryAdapter()\n    this.storageAdapter = new IndexedDBAdapter()\n  }\n\n  private async checkInitialized() {\n    if (!this.isInitialized) {\n      await this.queryAdapter.open()\n      await this.storageAdapter.open()\n      this.isInitialized = true\n    }\n  }\n\n  private async checkDatasetExists(datasetId: string) {\n    if (!(await this.hasDataset(datasetId))) {\n      throw new Error(`dataset ${datasetId} not exists, please create it first`)\n    }\n  }\n\n  public async createDataset(datasetId: string, columns: DatasetColumn[] = [], rawDatasetSource?: RawDatasetSource) {\n    await this.checkInitialized()\n\n    const datasetSource = rawDatasetSource ? await DatasetSourceBuilder.from(rawDatasetSource).build() : undefined\n    if (await this.hasDataset(datasetId)) {\n      throw new Error(`dataset ${datasetId} already exists`)\n    }\n    const datasetSchema = {\n      datasetId,\n      datasetAlias: datasetId,\n      columns: columns,\n    }\n    await this.storageAdapter.writeDataset(datasetId, datasetSchema, datasetSource)\n  }\n\n  public async updateDatasetSource(\n    datasetId: string,\n    columns: DatasetColumn[] = [],\n    rawDatasetSource?: RawDatasetSource,\n  ) {\n    await this.checkInitialized()\n    await this.checkDatasetExists(datasetId)\n\n    const datasetSource = rawDatasetSource ? await DatasetSourceBuilder.from(rawDatasetSource).build() : undefined\n    const datasetSchema = {\n      datasetId,\n      datasetAlias: datasetId,\n      columns: columns,\n    }\n    await this.storageAdapter.writeDataset(datasetId, datasetSchema, datasetSource)\n  }\n\n  public async dropDataset(datasetId: string) {\n    await this.checkInitialized()\n    await this.checkDatasetExists(datasetId)\n\n    await this.storageAdapter.deleteDataset(datasetId)\n  }\n\n  public async connectDataset(\n    datasetId: string,\n    temporaryColumns?: DatasetColumn[],\n    temporaryRawDatasetSource?: RawDatasetSource,\n  ): Promise<Dataset> {\n    await this.checkInitialized()\n    await this.checkDatasetExists(datasetId)\n\n    const dataset = new Dataset(this.queryAdapter, this.storageAdapter, datasetId)\n    const temporaryDatasetSource = temporaryRawDatasetSource\n      ? await DatasetSourceBuilder.from(temporaryRawDatasetSource).build()\n      : undefined\n\n    await dataset.init(temporaryColumns, temporaryDatasetSource)\n    return dataset\n  }\n\n  public async hasDataset(datasetId: string) {\n    await this.checkInitialized()\n\n    const datasets = await this.storageAdapter.listDatasets()\n    return datasets.some((item) => item.datasetId === datasetId)\n  }\n\n  public async listDatasets() {\n    await this.checkInitialized()\n\n    return this.storageAdapter.listDatasets()\n  }\n\n  public async close() {\n    await this.checkInitialized()\n    await this.queryAdapter.close()\n    await this.storageAdapter.close()\n  }\n}\n"],"names":["DimensionNodeBuilder","yMap","alias","DimensionsBuilder","doc","dsl","fieldOrDimension","callback","defaultDimension","Y","key","value","Object","dimensionNode","field","index","dimensions","item","node","MeasureNodeBuilder","encoding","aggregate","MeasuresBuilder","fieldOrMeasure","defaultMeasure","measureNode","measures","buildVQuery","vbiDSL","builder","wrapper","processor","queryDSL","pipe","buildSelect","buildGroupBy","buildLimit","context","result","measureSelects","measureNodes","measure","dimensionSelects","dimensionNodes","dimension","ChartTypeBuilder","e","trans","chartType","ChartTypeEnum","connectorMap","Map","getConnector","id","connector","Error","VBIBuilder","update","targetStateVector","connectorId","schema","queryResult","con","VBI","vbi","insightMap","dataset","insightDSL","threshold","stats","values","d","v","Number","m","median","mad","medianAbsoluteDeviation","nd","sKey","aKey","z","Math","insightInfo","valueField","window","outputField","timeField","base","i","prev","start","k","vv","mean","sd","standardDeviation","quickInsight","insightFn","PostgresDialect","DummyDriver","PostgresQueryCompiler","PostgresAdapter","db","options","escapeValue","String","convertDSLToSQL","tableName","where","qb","limit","toRaw","Kysely","eb","w","parts","c","sep","sql","leaf","items","Array","a","b","applyGroupBy","fields","exprs","f","o","compiled","inlineParameters","params","out","p","_","idx","isUrl","url","isHttpUrl","isBase64Url","DatasetSourceBuilder","raw","blob","type","Blob","csvSource","ArrayBuffer","JSON","jsonSource","xlsxSource","parquetSource","response","fetch","IndexedDBAdapter","dbName","Promise","resolve","reject","request","indexedDB","event","datasetId","datasetSchema","datasetSource","store","transaction","DuckDBWebQueryAdapter","MANUAL_BUNDLES","URL","bundle","selectBundle","worker_url","worker","Worker","logger","ConsoleLogger","AsyncDuckDB","fileName","source","uint8Array","Uint8Array","table","row","Dataset","duckDB","temporaryColumns","temporaryDatasetSource","datasetInfo","columns","dataTypeMap","readFunction","readFunctionMap","columnsStruct","columnNames","createViewSql","performance","Date","end","VQuery","rawDatasetSource","undefined","temporaryRawDatasetSource","datasets"],"mappings":"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"}