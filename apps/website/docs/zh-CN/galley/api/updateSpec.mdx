---
pageType: doc
---

# updateSpec

## 分段面积图

```tsx
const Demo = () => {
  const vseed: VSeed = {
    chartType: 'areaRange',
    dataset: [
      { date: '2019', region: 'east', city: 'A', profit: 10, sales: 60 },
      { date: '2019', region: 'east', city: 'B', profit: 30, sales: 60 },
      { date: '2019', region: 'east', city: 'C', profit: 30, sales: 60 },
      { date: '2019', region: 'east', city: 'D', profit: 50, sales: 60 },
      { date: '2019', region: 'east', city: 'E', profit: 40, sales: 60 },
      { date: '2020', region: 'east', city: 'A', profit: 100, sales: 60 },
      { date: '2020', region: 'east', city: 'B', profit: 123, sales: 60 },
      { date: '2020', region: 'east', city: 'C', profit: 134, sales: 60 },
      { date: '2020', region: 'east', city: 'D', profit: 111, sales: 60 },
      { date: '2020', region: 'east', city: 'E', profit: 210, sales: 60 },
    ],
    dimensions: [{ id: 'date' }, { id: 'city' }],
    measures: [{ id: 'profit' }, { id: 'sales' }],
    annotationHorizontalLine: {
      yValue: 60,
      text: 'text',
      textAlign: 'left',
      textPosition: 'insideStart',
    },
  }

  updateSpec('areaRange', (spec, context) => {
    const { vseed } = context

    const maxValue = Math.max(...vseed.dataset.map((d) => d.profit))
    const minValue = Math.min(...vseed.dataset.map((d) => d.profit))
    const middle = 60
    const percent = (maxValue - middle) / (maxValue - minValue)

    spec.series[0].area = {
      style: {
        curveType: 'monotoneX',
        fillOpacity: 0.15,
        fill: {
          gradient: 'linear',
          x0: 0.5,
          y0: 0,
          x1: 0.5,
          y1: 1,
          stops: [
            {
              offset: 0,
              color: '#5766EC',
            },
            {
              offset: percent,
              color: 'rgba(0,0,255,0)',
            },
            {
              offset: percent,
              color: 'rgba(0,0,255,0)',
            },
            {
              offset: 1,
              color: '#2ef1adff',
            },
          ],
        },
      },
    }
    spec.series[1].line = {
      style: {
        visible: true,
        curveType: 'monotoneX',
        stroke: {
          gradient: 'linear',
          x0: 0.5,
          y0: 0,
          x1: 0.5,
          y1: 1,
          stops: [
            {
              offset: 0,
              color: '#5766EC',
            },
            {
              offset: percent,
              color: '#5766EC',
            },
            {
              offset: percent,
              color: '#2ef1adff',
            },
            {
              offset: 1,
              color: '#2ef1adff',
            },
          ],
        },
      },
    }
    spec.series[2].line = {
      style: {
        visible: false,
        curveType: 'monotoneX',
      },
    }
    spec.markLine[0].startSymbol = {
      visible: true,
      style: {
        angle: 90,
      },
    }
    spec.markLine[0].endSymbol = {
      visible: false,
    }
    spec.tooltip.dimension.content = spec.tooltip.dimension.content.map((item) => {
      return {
        ...item,
        shapeFill: (a) => {
          console.log(a)
          return '#5766EC'
        },
      }
    })

    return spec
  })
  if (zVSeed.safeParse(vseed).success) {
    console.log('zVSeed parse success!!!')
  } else {
    console.error('zVSeed parse error!!!')
  }

  return <SimpleVSeedRender vseed={vseed} />
}

import { useRef, useEffect } from 'react'
import { useDark } from '@rspress/core/runtime'
import VChart from '@visactor/vchart'
import { ListTable, PivotTable, PivotChart, register } from '@visactor/vtable'
import {
  registerAll,
  VSeed,
  Builder,
  isPivotChart,
  isVChart,
  isPivotTable,
  isTable,
  zVSeed,
  updateSpec,
} from '@visactor/vseed'

registerAll()
register.chartModule('vchart', VChart)

const SimpleVSeedRender = (props: { vseed: VSeed }) => {
  const { vseed } = props
  const ref = useRef<HTMLDivElement>(null)
  const builderRef = useRef<Builder>()
  const dark = useDark()
  useEffect(() => {
    if (!ref.current) {
      return
    }
    const theme = dark ? 'dark' : 'light'
    const builder = Builder.from({ ...vseed, theme })
    const spec = builder.build()

    builderRef.current = builder
    if (isPivotChart(vseed)) {
      const tableInstance = new PivotChart(ref.current, spec)
      return () => tableInstance.release()
    } else if (isVChart(vseed)) {
      const vchart = new VChart(spec, { dom: ref.current })
      vchart.renderSync()
      return () => vchart.release()
    } else if (isTable(vseed)) {
      const tableInstance = new ListTable(ref.current, spec)
      return () => tableInstance.release()
    } else if (isPivotTable(vseed)) {
      const tableInstance = new PivotTable(ref.current, spec)
      return () => tableInstance.release()
    }
  }, [vseed, dark])

  return (
    <div
      ref={ref}
      style={{ height: 300, width: '100%' }}
      onClick={() => {
        console.group(`selected ${vseed.chartType}`)
        console.log('builder', builderRef.current)
        console.log('spec', builderRef.current.spec)
        console.log('vseed', builderRef.current.vseed)
        console.log('advancedVSeed', builderRef.current.advancedVSeed)
        console.groupEnd()
      }}
    ></div>
  )
}

export default Demo
```
