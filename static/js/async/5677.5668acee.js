"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["5677"],{59458:function(e,t,r){r.d(t,{T:()=>C});var o=r(87723),l=r(50173),i=r(52110),s=r(43735),n=r(18585),a=r(38512),h=r(17097),u=r(28651),d=r(75025),c=r(63388);function g(e,t){let r=t.getDrawRange();if((0,n.Z)(e)&&e>=t.frozenRowCount){let o=t.getFrozenRowsHeight(),l=t.getRowsHeight(0,e-1);t.scrollTop=Math.min(l-o,t.getAllRowsHeight()-r.height)-1}t.scenegraph.updateNextFrame()}var p=r(66209);(0,l.R2)(),(0,l.Eg)(),(0,l.I)(),(0,l.FD)(),(0,l._t)(),(0,l.Mh)(),d.F.registerComponent("listTreeStickCellPlugin",class e{constructor(e){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=e,this.table.on("scroll",e=>{"vertical"===e.scrollDirection&&this.updateGroupTitle()}),this.table.on("tree_hierarchy_state_change",e=>{this.updateGroupTitle()}),this.table.on("resize_column",e=>{this.updateGroupTitle()})}updateGroupTitle(){0===this.table.scrollTop?(this.titleRows=[],this.showedTitleRows=[]):-1!==this.skipStartRow&&-1!==this.skipEndRow&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;let e=this.table.getRecordIndexByCell(0,this.rowNow),t=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(e,t)}getTitleRowsByRecordIndex(e,t){let r=[];(0,s.Z)(e)||(e=[e]),(0,s.Z)(t)||(t=[t]);for(let t=0;t<e.length;t++){let o=e.slice(0,t+1),l=this.table.dataSource.getRaw(o);r.push(l)}let o=[],l=t.length===e.length+1,i=e.slice(0,l?e.length:e.length-1),n=this.table.dataSource.currentIndexedData;for(let t=this.rowNow-this.table.columnHeaderLevelCount;t>=0;t--){let r=n[t];if((0,s.Z)(r)&&i.length===r.length){let e=!0;for(let t=0;t<r.length;t++)if(r[t]!==i[t]){e=!1;break}e&&(o.push(t+this.table.columnHeaderLevelCount),i=i.slice(0,i.length-1))}else if(r===e[0]){o.push(t+this.table.columnHeaderLevelCount);break}}this.titleRows=o.reverse()}updateScenegraph(){let{table:e}=this,{shadowGroup:t,shadowGroupFrozen:r}=function(e){let t=e.scenegraph.colHeaderGroup,r=e.scenegraph.cornerHeaderGroup;if(!t.border){let r=(0,u.f)({x:0,y:0,width:0,height:0,cursor:"pointer"});t.add(r),t.border=r,r.attachShadow(r.shadowRoot),r.name="border-rect",r.addEventListener("click",t=>{let r=e.listTreeStickCellPlugin.titleRows,{shadowTarget:o}=t.pickParams,{col:l,row:i}=(0,c.J$)(o);g(i-r.indexOf(i),e)})}if(!r.border){let t=(0,u.f)({x:0,y:0,width:0,height:0,cursor:"pointer"});r.add(t),r.border=t,t.attachShadow(t.shadowRoot),t.name="border-rect",t.addEventListener("click",t=>{let r=e.listTreeStickCellPlugin.titleRows,{shadowTarget:o}=t.pickParams,{col:l,row:i}=(0,c.J$)(o);g(i-r.indexOf(i),e)})}let o=t.border.shadowRoot,l=r.border.shadowRoot;return o.removeAllChild(),l.removeAllChild(),{shadowGroup:o,shadowGroupFrozen:l}}(e);this.showedTitleRows.length=0;let o=0;for(let d=0;d<e.colCount;d++){let c;d<e.frozenColCount?(c=new a.Z({x:e.getColsWidth(0,d-1),y:e.getFrozenRowsHeight()}),r.add(c)):(c=new a.Z({x:e.getColsWidth(e.frozenColCount,d-1),y:e.getFrozenRowsHeight()}),t.add(c)),c.col=d;for(let t=0;t<this.titleRows.length;t++){var l,i,s,n;let r=this.titleRows[t];if(l=r,i=this.rowNow,s=e.scenegraph.proxy.screenTopRow,n=this.titleRows,l===i&&l!==s+n.length-1||l===s+n.indexOf(l)+1&&l<i){0===d&&o++;continue}0===d&&this.showedTitleRows.push(r);let a=e.scenegraph.getCell(d,r);if("cell"===a.role){let e=function e(t){let r=t.clone();if(r.role=t.role,r.col=t.col,r.row=t.row,r.mergeStartCol=t.mergeStartCol,r.mergeStartRow=t.mergeStartRow,r.mergeEndCol=t.mergeEndCol,r.mergeEndRow=t.mergeEndRow,r.contentWidth=t.contentWidth,r.contentHeight=t.contentHeight,"cell"===r.role){let e=(0,u.f)({x:0,y:0,width:r.attribute.width,height:r.attribute.height});r.add(e)}return"group"===t.type&&t.forEachChildren(t=>{let o=e(t);r.add(o)}),r}(a);e.setAttributes({y:40*t}),c.add(e)}else{let o=(0,h.wW)(d,r,e,!0,!0);o.setAttributes({y:40*t}),c.add(o)}}}o>0&&-1===this.skipStartRow&&-1===this.skipEndRow&&(this.skipStartRow=e.scenegraph.proxy.screenTopRow-1,this.skipEndRow=e.scenegraph.proxy.screenTopRow+1)}}),(0,i.zf)(),(0,l.ph)(),(0,p.LQ)(),(0,p.yR)(),(0,p.pk)(),(0,p.m4)(),(0,p.Jy)(),(0,p.VT)(),(0,p.ah)(),(0,p.dB)(),(0,p.ge)(),(0,p.au)();class C extends o.e{}},87723:function(e,t,r){r.d(t,{e:()=>N});var o=r(12348),l=r(91212),i=r(18585),s=r(90251),n=r(61768),a=r(43221),h=r(20901);class u{constructor(e,t,r,o){var l,i;this.seqId=0,this._columnMaxDepth=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=r,this._table=e,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this._columnMaxDepth=this._calculateMaxDepth(t),this.hierarchyIndent=null!=o?o:20,this.hierarchyTextStartAlignment=e.options.hierarchyTextStartAlignment,this.columnHierarchyType=e.options.headerHierarchyType,this.columnExpandLevel=null!=(l=e.options.headerExpandLevel)?l:1,this.columnTree=new h.KO(t,{seqId:0},null!=(i=this.columnHierarchyType)?i:null,"grid-tree"===this.columnHierarchyType?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,t,[]),this._headerObjects=this._headerObjectsIncludeHided.filter(e=>!0!==e.define.hide),this._headerObjectMap=this._headerObjects.reduce((e,t)=>(e[t.id]=t,e),{}),this.rowHierarchyType=(0,a.C1)(this)?"tree":"grid",this._hasAggregation=(0,a.MP)(this),this._hasAggregationOnBottomCount=(0,a.WM)(this),this._hasAggregationOnTopCount=(0,a.OT)(this),this.handleRowSeriesNumber(e.internalProps.rowSeriesNumber)}handleRowSeriesNumber(e){var t,r,o;e&&(Array.isArray(e)?this.rowSeriesNumberColumn=e.map((e,t)=>{var r,o;return{id:this.seqId++,title:e.title,define:(0,l.Z)({field:"_vtable_rowSeries_number_"+t},e),cellType:null!=(r=e.cellType)?r:"text",headerType:"checkbox"===e.cellType?"checkbox":"text",style:e.style,width:e.width,format:e.format,field:null!=(o=e.field)?o:"_vtable_rowSeries_number_"+t,icon:e.icon,headerIcon:e.headerIcon,isChildNode:!1}}):this.rowSeriesNumberColumn=[{id:this.seqId++,title:e.title,define:(0,l.Z)({field:"_vtable_rowSeries_number"},e),cellType:null!=(t=e.cellType)?t:"text",headerType:null!=(r=e.headerType)?r:"checkbox"===e.cellType?"checkbox":"text",style:e.style,width:e.width,format:e.format,field:null!=(o=e.field)?o:"_vtable_rowSeries_number",icon:e.icon,headerIcon:e.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(e=>!0),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(e=>!1),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(e){this._transpose=e}get showHeader(){return this._showHeader}set showHeader(e){this._showHeader=e}isSeriesNumberInHeader(e,t){if(this.leftRowSeriesNumberColumnCount>0&&e>=0&&t>=0&&e<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(t<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(t<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(e,t){return!!(this.leftRowSeriesNumberColumnCount>0)&&!!(e>=0)&&!!(e<this.leftRowSeriesNumberColumnCount)&&(!!this.transpose||!!(t>=this.headerLevelCount))||!!(this.rightRowSeriesNumberColumnCount>0)&&!!(e>=this.colCount-this.rightRowSeriesNumberColumnCount)&&(!!this.transpose||!!(t>=this.headerLevelCount))||!1}isSeriesNumber(e,t){return!!((0,i.Z)(e)&&(0,i.Z)(t))&&(!!(this.leftRowSeriesNumberColumnCount>0)&&!!(e>=0)&&!!(t>=0)&&!!(e<this.leftRowSeriesNumberColumnCount)||!!(this.rightRowSeriesNumberColumnCount>0)&&!!(t>=0)&&!!(e>=this.colCount-this.rightRowSeriesNumberColumnCount))||!1}getSeriesNumberHeader(e,t){if(this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(t<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[e],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t<this.headerLevelCount){if(this.transpose)return;if(t<this.headerLevelCount)return this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(e,t){return this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount&&(this.transpose||t>=this.headerLevelCount)?this.leftRowSeriesNumberColumn[e]:this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&(this.transpose||t>=this.headerLevelCount)?this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}isHeader(e,t){return!!(this.transpose&&e>=this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&t>=0&&t<this.headerLevelCount}isAggregation(e,t){if(this.hasAggregation){if(this.hasAggregationOnBottomCount){if(this.transpose){if(e>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(t>=this.rowCount-this.hasAggregationOnBottomCount)return!0}if(this.hasAggregationOnTopCount){if(this.transpose){if(e>=this.rowHeaderLevelCount&&e<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(t>=this.columnHeaderLevelCount&&t<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}}return!1}isTopAggregation(e,t){if(this.hasAggregationOnTopCount){if(this.transpose){if(e>=this.rowHeaderLevelCount&&e<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(t>=this.columnHeaderLevelCount&&t<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isBottomAggregation(e,t){if(this.hasAggregationOnBottomCount){if(this.transpose){if(e>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(t>=this.rowCount-this.hasAggregationOnBottomCount)return!0}return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(e,t){return this.getColumnDefine(e,t).vtable_aggregator}getAggregatorsByCellRange(e,t,r,o){let l=[];if(!this.transpose){for(let o=e;o<=r;o++){let e=this.getColumnDefine(o,t);e.vtable_aggregator&&(l=l.concat(Array.isArray(e.vtable_aggregator)?e.vtable_aggregator:[e.vtable_aggregator]))}return l}for(let r=t;r<=o;r++){let t=this.getColumnDefine(e,r);t.vtable_aggregator&&(l=l.concat(Array.isArray(t.vtable_aggregator)?t.vtable_aggregator:[t.vtable_aggregator]))}return[]}getAggregatorOnTop(e,t){let r=this.getColumnDefine(e,t),o=r.vtable_aggregator,l=r.aggregation;if(Array.isArray(l)){let r=l.reduce((e,t,r)=>(t.showOnTop&&e.push(r),e),[]).map(e=>o[e]);return this.transpose?r[e-this.rowHeaderLevelCount]:r[t-this.columnHeaderLevelCount]}return this.transpose&&e-this.rowHeaderLevelCount==0?(null==l?void 0:l.showOnTop)?o:null:this.transpose||t-this.columnHeaderLevelCount!=0?null:(null==l?void 0:l.showOnTop)?o:null}getAggregatorOnBottom(e,t){let r=this.getColumnDefine(e,t),o=r.vtable_aggregator,l=r.aggregation;if(Array.isArray(l)){let r=l.reduce((e,t,r)=>(t.showOnTop||e.push(r),e),[]).map(e=>o[e]);return this.transpose?r[e-(this.colCount-this.hasAggregationOnBottomCount)]:r[t-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&e-(this.colCount-this.hasAggregationOnBottomCount)==0?(null==l?void 0:l.showOnTop)?null:o:this.transpose||t-(this.rowCount-this.hasAggregationOnBottomCount)!=0||(null==l?void 0:l.showOnTop)?null:o}getAggregatorCellAddress(e,t,r,o){let l=[],i=this.hasAggregationOnTopCount,s=this.hasAggregationOnBottomCount;if(this.transpose){for(let r=t;r<=o;r++)if(this.getColumnDefine(e,r).vtable_aggregator){for(let e=0;e<i;e++)l.push({col:this.headerLevelCount+e,row:r});for(let e=0;e<s;e++)l.push({col:this.rowCount-s+e,row:r})}}else for(let o=e;o<=r;o++)if(this.getColumnDefine(o,t).vtable_aggregator){for(let e=0;e<i;e++)l.push({col:o,row:this.headerLevelCount+e});for(let e=0;e<s;e++)l.push({col:o,row:this.rowCount-s+e})}return l}getCellLocation(e,t){return this.isHeader(e,t)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(e,t){return!!(this.transpose&&e>=this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(e,t){return!this.transpose&&t>=0&&t<=this.headerLevelCount-1&&e>=this.leftRowSeriesNumberColumnCount&&e<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(e,t){if((0,i.Z)(t)){if(e>=0&&e<this.frozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&e>=0&&e<this.frozenColCount)return!0;return!1}isRightFrozenColumn(e,t){if((0,i.Z)(t)){if(e>=this.colCount-this.rightFrozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&e>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(e,t){if((0,i.Z)(t)){if(t>=0&&t<this.frozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.frozenRowCount>0&&t>=0&&t<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(e,t){if((0,i.Z)(t)){if(t>=this.rowCount-this.bottomFrozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.bottomFrozenRowCount>0&&t>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=0&&t<this.frozenRowCount}isLeftBottomCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=0&&t<this.frozenRowCount}isRightBottomCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(e,t){return!1}getColumnHeaderRange(){var e,t;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!=(e=this.rowCount)?e:0)-1}}:{start:{col:0,row:0},end:{col:(null!=(t=this.colCount)?t:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var e,t;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!=(e=this.rowCount)?e:0)-1}}:{start:{col:0,row:0},end:{col:(null!=(t=this.colCount)?t:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var e,t,r,o;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:(null!=(e=this.colCount)?e:0)-1,row:(null!=(t=this.rowCount)?t:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:(null!=(r=this.colCount)?r:0)-1,row:(null!=(o=this.rowCount)?o:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(e){this._recordsCount=e}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){let e=this.leftRowSeriesNumberColumn.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}));return e.push(...this._columns.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}))),e}return this._columns.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}))}getColumnWidthDefined(e){var t;if(e>=0){if(e<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[e];if(this.transpose){let r,o,l=0;if(e>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let e;return this.columnObjects.forEach((t,i)=>{"number"==typeof t.width?l=Math.max(t.width,l):"auto"===t.width&&(e=!0),"number"==typeof t.minWidth&&(o=Math.max(t.minWidth,o)),"number"==typeof t.maxWidth&&(r=Math.max(t.maxWidth,r))}),{width:l=l>0?l:e?"auto":void 0,minWidth:o,maxWidth:r}}if(this.isRowHeader(e,0)){let r=Array.isArray(this._table.defaultHeaderColWidth)?null!=(t=this._table.defaultHeaderColWidth[e])?t:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return"auto"===r?{width:"auto"}:{width:r}}}return this._columns[e-this.leftRowSeriesNumberColumnCount]}}getCellId(e,t){var r,o,l,i;return this.transpose?e>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?null==(r=this._columns[t])?void 0:r.id:this.isSeriesNumber(e,t)?t+"_series_number":null==(o=this._headerCellIds[e-this.leftRowSeriesNumberColumnCount])?void 0:o[t]:this.isSeriesNumber(e,t)?this.rowSeriesNumberColumn[e].id:this.headerLevelCount<=t?null==(l=this._columns[e-this.leftRowSeriesNumberColumnCount])?void 0:l.id:null==(i=this._headerCellIds[t])?void 0:i[e-this.leftRowSeriesNumberColumnCount]}getHeader(e,t){if(this.isSeriesNumberInHeader(e,t))return this.getSeriesNumberHeader(e,t);let r=this.getCellId(e,t);return this._headerObjectMap[r]}getHeaderField(e,t){var r,o,l;if(this.isSeriesNumberInHeader(e,t))return null==(r=this.getSeriesNumberHeader(e,t))?void 0:r.field;if(this.isSeriesNumberInBody(e,t))return null==(o=this.getSeriesNumberBody(e,t))?void 0:o.field;let i=this.getCellId(e,t);return(null==(l=this._headerObjectMap[i])?void 0:l.field)||(this.transpose?this._columns[t]&&this._columns[t].field:this._columns[e-this.leftRowSeriesNumberColumnCount]&&this._columns[e-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(e){for(let t=0;t<this._headerCellIds.length;t++){let r=this._headerCellIds[t];for(let o=0;o<r.length;o++)if(r[o]===e)return this.transpose?{col:t,row:o}:{col:o+this.leftRowSeriesNumberColumnCount,row:t}}}getHeaderCellAddressByField(e){let t=this.headerObjects.find(t=>t&&t.field===e);return t&&this.getHeaderCellAdressById(t.id)}getBody(e,t){return this.isSeriesNumber(e,t)?this.getSeriesNumberBody(e,t):this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(e){var t,r;if(this.transpose){for(let r=0;r<(null!=(t=this.rowCount)?t:0);r++)if(e===this._columns[r].id)return{start:{col:0,row:r},end:{col:0,row:r}}}else for(let t=this.leftRowSeriesNumberColumnCount;t<(null!=(r=this.colCount)?r:0);t++)if(e===this._columns[t-this.leftRowSeriesNumberColumnCount].id)return{start:{col:t,row:0},end:{col:t,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(e,t){return function(e,t,r){var o,l,i;if(-1===e||-1===t)return{start:{col:e,row:t},end:{col:e,row:t}};if(r._cellRangeMap.has(`$${e}$${t}`))return r._cellRangeMap.get(`$${e}$${t}`);let s={start:{col:e,row:t},end:{col:e,row:t}};if(r.transpose)s=function(e,t,r){var o,l,i,s;let n={start:{col:e,row:t},end:{col:e,row:t}};if(r.headerLevelCount+r.leftRowSeriesNumberColumnCount<=e||-1===e&&-1===t){if(r.headerLevelCount+r.leftRowSeriesNumberColumnCount<=e&&(null==(l=null==(o=r.columnObjects[t])?void 0:o.define)?void 0:l.mergeCell)){let o=r._table.getCellValue(e,t);for(let l=e-1;l>=r.headerLevelCount+r.leftRowSeriesNumberColumnCount;l--){let i=r._table.getCellValue(l,t);if("boolean"==typeof r.columnObjects[t].define.mergeCell){if(o!==i)break}else if(!r.columnObjects[t].define.mergeCell(o,i,{source:{col:e,row:t},target:{col:l,row:t},table:r._table}))break;n.start.col=l}for(let l=e+1;l<(null!=(i=r.colCount)?i:0);l++){let i=r._table.getCellValue(l,t);if("boolean"==typeof r.columnObjects[t].define.mergeCell){if(o!==i)break}else if(!r.columnObjects[t].define.mergeCell(o,i,{source:{col:e,row:t},target:{col:l,row:t},table:r._table}))break;n.end.col=l}}return n}let a=r.getCellId(e,t);for(let o=t-1;o>=0&&a===r.getCellId(e,o);o--)n.start.row=o;for(let o=t+1;o<(null!=(s=r.rowCount)?s:0)&&a===r.getCellId(e,o);o++)n.end.row=o;for(let o=e-1;o>=0&&a===r.getCellId(o,t);o--)n.start.col=o;for(let o=e+1;o<r.headerLevelCount+r.leftRowSeriesNumberColumnCount&&a===r.getCellId(o,t);o++)n.end.col=o;return n}(e,t,r);else if(r.headerLevelCount<=t){if(r.headerLevelCount<=t&&(null==(l=null==(o=r.columnObjects[e-r.leftRowSeriesNumberColumnCount])?void 0:o.define)?void 0:l.mergeCell)){let o=r._table.getCellValue(e,t);for(let l=t-1;l>=r.headerLevelCount;l--){let i=r._table.getCellValue(e,l);if("boolean"==typeof r.columnObjects[e-r.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==i)break}else if(!r.columnObjects[e-r.leftRowSeriesNumberColumnCount].define.mergeCell(o,i,{source:{col:e,row:t},target:{col:e,row:l},table:r._table}))break;s.start.row=l}for(let l=t+1;l<r.rowCount;l++){let i=r._table.getCellValue(e,l);if("boolean"==typeof r.columnObjects[e-r.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==i)break}else if(!r.columnObjects[e-r.leftRowSeriesNumberColumnCount].define.mergeCell(o,i,{source:{col:e,row:t},target:{col:e,row:l},table:r._table}))break;s.end.row=l}}!function(e,t,r,o){if("tree"!==o.rowHierarchyType)return;let l=o._table.getCellRawRecord(e,t);o._table.internalProps.groupTitleCheckbox&&o._table.internalProps.rowSeriesNumber?(null==l?void 0:l.vtableMerge)&&e>=o.leftRowSeriesNumberColumnCount&&(r.start.col=o.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount,r.end.col=o.colCount-1,r.start.row=r.end.row=t):(null==l?void 0:l.vtableMerge)&&(r.start.col=o.rowHeaderLevelCount,r.end.col=o.colCount-1,r.start.row=r.end.row=t)}(e,t,s,r)}else{let o=r.getCellId(e,t);for(let l=e-1;l>=0&&o===r.getCellId(l,t);l--)s.start.col=l;for(let l=e+1;l<(null!=(i=r.colCount)?i:0)&&o===r.getCellId(l,t);l++)s.end.col=l;for(let l=t-1;l>=0&&o===r.getCellId(e,l);l--)s.start.row=l;for(let l=t+1;l<r.headerLevelCount&&o===r.getCellId(e,l);l++)s.end.row=l}return r._cellRangeMap.set(`$${e}$${t}`,s),s}(e,t,this)}isCellRangeEqual(e,t,r,o){let l=this.getCellRange(e,t),i=this.getCellRange(r,o);return l.start.col===i.start.col&&l.end.col===i.end.col&&l.start.row===i.start.row&&l.end.row===i.end.row}getRecordShowIndexByCell(e,t){let r=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?e<r?-1:e-r:t<r?-1:t-r}getRecordStartRowByRecordIndex(e){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+e}_calculateMaxDepth(e,t=0){let r=t;return e.forEach(e=>{if(e.columns&&e.columns.length>0){let o=this._calculateMaxDepth(e.columns,t+1);o>r&&(r=o)}}),r}_addHeaders(e,t,r,l,i){let n=[],a=this._newRow(e,l);return t.forEach(t=>{var h,u,d,c;let g=this._columns.length,p=this.seqId++,C={id:p,title:null!=(h=t.title)?h:t.caption,headerIcon:t.headerIcon,field:t.field,style:t.headerStyle,headerType:null!=(u=t.headerType)?u:"text",dropDownMenu:t.dropDownMenu,define:t,hierarchyState:t.hierarchyState,columnWidthComputeMode:t.columnWidthComputeMode};n[p]=C;let w=e;if(t.levelSpan){w=Math.min(e+t.levelSpan-1,this._columnMaxDepth-1);for(let t=e;t<=w;t++)this._headerCellIds[t]||(this._headerCellIds[t]=[]),void 0===this._headerCellIds[t][g]&&(this._headerCellIds[t][g]=p)}if(i)for(let e=w-1;e>=0;e--)this._headerCellIds[e]&&void 0===this._headerCellIds[e][g]&&void 0!==r[w-i]&&(this._headerCellIds[e][g]=r[w-i]);else for(let e=w-1;e>=0;e--)this._headerCellIds[e]&&void 0===this._headerCellIds[e][g]&&void 0!==r[e]&&(this._headerCellIds[e][g]=r[e]);l?this._headerCellIds[e-1]&&void 0!==this._headerCellIds[e-1][g]&&(a[g]=this._headerCellIds[e-1][g]):a[g]=p;let f=!t.hierarchyState||t.hierarchyState===o.g.expand;if(t.columns&&f)t.columns.every(e=>e.hide)||this._addHeaders(w+1,t.columns,[...r,p],t.hideColumnsSubHeader||l,t.levelSpan).forEach(e=>n.push(e));else{let r={id:this.seqId++,field:t.field,fieldFormat:t.fieldFormat,width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth,icon:t.icon,cellType:null!=(c=null!=(d=t.cellType)?d:t.columnType)?c:"text",chartModule:"chartModule"in t?t.chartModule:null,chartSpec:"chartSpec"in t?t.chartSpec:null,sparklineSpec:"sparklineSpec"in t?t.sparklineSpec:s.hW,style:t.style,define:t,columnWidthComputeMode:t.columnWidthComputeMode,disableColumnResize:null==t?void 0:t.disableColumnResize,aggregation:t.aggregation,isChildNode:e>=1};if(this._columnsIncludeHided.push(r),!0!==t.hide){this._columns.push(r);for(let t=e+1;t<this._headerCellIds.length;t++)this._headerCellIds[t][g]=p}}}),n}_newRow(e,t=!1){if(this._headerCellIds[e]){let t=this._headerCellIds[e-1];if(t.length>this._headerCellIds[e].length)for(let r=this._headerCellIds[e].length;r<t.length;r++)this._headerCellIds[e][r]=t[r];return this._headerCellIds[e]}if(t)return[];let r=this._headerCellIds[e]=[];if(!this._columns.length)return r;let o=this._headerCellIds[e-1];for(let e=0;e<o.length;e++)r[e]=o[e];return r}getCellHeaderPaths(e,t){if(this.isSeriesNumber(e,t))return;let r=[],o=[];return this.transpose?o=[{field:this._columns[t].field}]:r=[{field:this._columns[e-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:r,rowHeaderPaths:o,cellLocation:this.getCellLocation(e,t)}}getParentCellId(e,t){if(0!==t){if(this.isColumnHeader(e,t))return this.getCellId(e,t-1);if(this.isRowHeader(e,t)){if(this.isSeriesNumberInBody(e-1,t))return;return this.getCellId(e-1,t)}}}canMoveHeaderPosition(e,t){if(this.isSeriesNumberInHeader(t.col,t.row)||this.isSeriesNumberInHeader(e.col,e.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(t.col,t.row)&&this.isSeriesNumberInBody(e.col,e.row)){let r=this.getRecordShowIndexByCell(0,e.row),o=this.getRecordShowIndexByCell(0,t.row);return this._table.dataSource.canChangeOrder(r,o)}if(this.transpose&&this.isSeriesNumberInBody(t.col,t.row)&&this.isSeriesNumberInBody(e.col,e.row)&&(this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode&&this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode?(e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(e.col=e.col+this.leftRowSeriesNumberColumnCount,t.col=t.col+this.leftRowSeriesNumberColumnCount)),e.col<0||e.row<0||t.col<0||t.row<0||"disabled"===this._table.internalProps.frozenColDragHeaderMode&&this._table.isFrozenColumn(t.col))return!1;let r=this.getCellRange(e.col,e.row);return this.isColumnHeader(e.col,e.row)?this.getParentCellId(e.col,r.start.row)===this.getParentCellId(t.col,r.start.row):!!this.isRowHeader(e.col,e.row)&&this.getParentCellId(r.start.col,e.row)===this.getParentCellId(r.start.col,t.row)}moveHeaderPosition(e,t){var r,o;if((!(null==(r=this._table.options.dragOrder)?void 0:r.validateDragOrderOnEnd)||(null==(o=this._table.options.dragOrder)?void 0:o.validateDragOrderOnEnd(e,t)))&&this.canMoveHeaderPosition(e,t)){let r=this.getCellRange(e.col,e.row);if(this.isColumnHeader(e.col,e.row)){let o,l=r.end.col-r.start.col+1,i=this.getCellRange(t.col,r.start.row);if((o=t.col>=e.col?i.end.col-l+1:i.start.col)===r.start.col)return null;for(let e=0;e<this._headerCellIds.length;e++){let t=this._headerCellIds[e].splice(r.start.col-this.leftRowSeriesNumberColumnCount,l);t.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[e],t)}let s=this._columns.splice(r.start.col-this.leftRowSeriesNumberColumnCount,l);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(r.start.row,r.start.col-this.leftRowSeriesNumberColumnCount,o-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:r.start.col,targetIndex:o,sourceSize:l,targetSize:i.end.col-i.start.col+1,moveType:"column"}}if(this.isRowHeader(e.col,e.row)||this.isSeriesNumberInBody(e.col,e.row)&&this.transpose){let o;this.isSeriesNumberInBody(e.col,e.row)&&(r=this.getCellRange(e.col+this.leftRowSeriesNumberColumnCount,e.row));let l=r.end.row-r.start.row+1,i=this.getCellRange(r.start.col,t.row);if((o=t.row>=e.row?i.end.row-l+1:i.start.row)===r.start.row)return null;for(let e=0;e<this._headerCellIds.length;e++){let t=this._headerCellIds[e].splice(r.start.row,l);t.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[e],t)}let s=this._columns.splice(r.start.row,l);return s.unshift(o,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(r.start.col-this.leftRowSeriesNumberColumnCount,r.start.row,o+(t.row>e.row?r.end.row-r.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:r.start.row,targetIndex:o,sourceSize:l,targetSize:i.end.row-i.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(e.col,e.row))return{sourceIndex:e.row,targetIndex:t.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(e){return{addCellPositions:e.add.map(e=>({col:0,row:this._table.columnHeaderLevelCount+e})),removeCellPositions:e.remove.map(e=>({col:0,row:this._table.columnHeaderLevelCount+e}))}}setChartInstance(e,t,r){let o=this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount];"function"!=typeof o.chartSpec&&(o.chartInstance=r)}getChartInstance(e,t){return(this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return(0,n.YL)(this)}getAxisConfigInPivotChart(e,t){}isEmpty(e,t){return!1}isAxisCell(e,t){return!1}getChartAxes(e,t){return[]}isShareChartSpec(e,t){let r=this.getBody(e,t);return"function"!=typeof(null==r?void 0:r.chartSpec)}isNoChartDataRenderNothing(e,t){let r=this.getBody(e,t);return(null==r?void 0:r.define).noDataRenderNothing}getChartSpec(e,t){return this.getRawChartSpec(e,t)}getRawChartSpec(e,t){let r=this.getBody(e,t),o=null==r?void 0:r.chartSpec;return"function"==typeof o?o({col:e,row:t,dataValue:this._table.getCellOriginValue(e,t)||"",value:this._table.getCellValue(e,t)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(e,t)),table:this._table}):o}getChartDataId(e,t){return(0,n.py)(e,t,this)}release(){let e=this._table._getActiveChartInstance();null==e||e.release(),this.columnObjects.forEach(e=>{var t;null==(t=e.chartInstance)||t.release()})}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(e,t,r){let o=this._table.internalProps.layoutMap.getHeader(e,t);o.title=r,o.define.title=r}getColumnByField(e){var t;return null==(t=this.columnObjects)?void 0:t.reduce((t,r,o)=>(r.field===e&&t.push({col:o,columnDefine:r}),t),[])}getColumnByKey(e){var t;let r;return{columnDefine:null==(t=this.columnObjects)?void 0:t.find((t,o)=>{var l;return(null==(l=t.define)?void 0:l.key)===e&&(r=o+this.leftRowSeriesNumberColumnCount,!0)}),col:r}}getColumnDefine(e,t){if(e>=0)return e<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[e].define:this.transpose?this._columns[t].define:this._columns[e-this.leftRowSeriesNumberColumnCount].define}}var d=r(43735),c=r(50071),g=r(56616),p=r(83847),C=r(27180),w=r(62482),f=r(90321),m=r(9649),y=r(28071),S=r(45847),R=r(70656),b=r(65962),v=r(75025),P=r(58853);function _(e){return(0,P.Z)(e)?{groupByRules:[e]}:(0,d.Z)(e)?{groupByRules:e.map(e=>(0,P.Z)(e)?e:e.key)}:{}}var H=r(80983),M=r(78958),I=r(77597);function A(e){let t=e.sortState;(t=!t||Array.isArray(t)?t:[t])&&(t=t.map(t=>{var r;return t.orderFn=null!=(r=e._getSortFuncFromHeaderOption(void 0,t.field))?r:y.K$,t}),e.dataSource.sort(t))}var T=r(62727);class N extends g.D{constructor(e,t){var r,o,l,s,n,a,h,u;super(e,t),this.showHeader=!0,t=this.options;let d=this.internalProps;if(d.frozenColDragHeaderMode=null!=(o=null==(r=t.dragOrder)?void 0:r.frozenColDragHeaderMode)?o:t.frozenColDragHeaderMode,this.pagination=t.pagination,d.sortState=t.sortState,d.multipleSort=!!t.multipleSort,d.dataConfig=this.internalProps.groupBy?_(this.internalProps.groupBy):{},d.columns=t.columns?(0,R.u)(t.columns,["children"]):t.header?(0,R.u)(t.header,["children"]):[],(0,c.rQ)(this),d.enableTreeNodeMerge=null!=(s=null!=(l=t.enableTreeNodeMerge)?l:(0,i.Z)(this.internalProps.groupBy))&&s,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=null==(n=t.showHeader)||n,this.internalProps.columnWidthConfig=t.columnWidthConfig,this.transpose=null!=(a=t.transpose)&&a,"node"!==C.X.mode&&(this.editorManager=new f.$(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:d.sortState}):this.setRecords([]),t.title&&(d.title=new(v.F.getComponent("title"))(t.title,this),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)null==(h=this.internalProps.emptyTip)||h.resetVisible();else{let e=v.F.getComponent("emptyTip");this.internalProps.emptyTip=new e(this.options.emptyTip,this),null==(u=this.internalProps.emptyTip)||u.resetVisible()}if(this.internalProps.enableTreeStickCell){let e=v.F.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new e(this)}setTimeout(()=>{this.fireListeners(p.B.INITIALIZED,null)},0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var e;return null==(e=this.dataSource)?void 0:e.records}get recordsCount(){return this.dataSource.records.length}updateColumns(e,t){var r,o,l,i;this.scenegraph.clearCells();let s={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=(0,R.u)(e,["children"]),(0,c.rQ)(this),(null==t?void 0:t.clearColWidthCache)&&this.internalProps._widthResizedColMap.clear(),this.options.columns=e,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),null==(o=(r=this.dataSource).updateColumns)||o.call(r,this.internalProps.columns),this.records&&(0,c.bW)(this.internalProps.columns)&&this.dataSource.processRecords(null!=(i=null==(l=this.dataSource.dataSourceObj)?void 0:l.records)?i:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(s.col,s.row),this.renderAsync(),this.eventManager.updateEventBinder()}_recreateSceneForStateChange(){var e,t;this.scenegraph.clearCells();let r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this._hasAutoImageColumn=void 0,this.refreshHeader(),this.records&&(0,c.bW)(this.internalProps.columns)&&this.dataSource.processRecords(null!=(t=null==(e=this.dataSource.dataSourceObj)?void 0:e.records)?t:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.renderAsync(),this.eventManager.updateEventBinder()}addColumn(e){let t=this.options.columns;t.push(e),this.updateColumns(t)}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(e){this.internalProps.columns=e,(0,c.rQ)(this),this.options.header=e,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var e;return null!=(e=this.internalProps.transpose)&&e}set transpose(e){this.internalProps.transpose!==e&&(this.internalProps.transpose=e,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=e,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(e,t,r){var o;if(-1===e||-1===t)return null;if(!r){let r=this.getCustomMergeValue(e,t);if(r)return r}if(this.internalProps.layoutMap.isSeriesNumber(e,t)){let r;if(this.internalProps.layoutMap.isSeriesNumberInHeader(e,t)){let{title:r}=this.internalProps.layoutMap.getSeriesNumberHeader(e,t);return r}if(this.internalProps.groupBy){let o=this.getCellRawRecord(e,t);if(null==o?void 0:o.vtableMerge)return"";this.internalProps.layoutMap.isAggregation(e,t)||(r=this.dataSource.getGroupSeriesNumber(t-this.columnHeaderLevelCount))}else{let l=this.getBodyColumnDefine(e,t),i=this.getFieldData(l.field,e,t);r="string"==typeof i?i:(null==i?void 0:i.text)?null!=(o=i.text)?o:"":t-this.columnHeaderLevelCount+1}let{format:l}=this.internalProps.layoutMap.getSeriesNumberBody(e,t);return"function"==typeof l?l(e,t,this,r):r}if(this.internalProps.layoutMap.isHeader(e,t)){let{title:r}=this.internalProps.layoutMap.getHeader(e,t);return"function"==typeof r?r():r}if(this.internalProps.layoutMap.isAggregation(e,t)){if(this.internalProps.layoutMap.isTopAggregation(e,t)){let r=this.internalProps.layoutMap.getAggregatorOnTop(e,t);return(null==r?void 0:r.formatValue)?r.formatValue(e,t,this):""}if(this.internalProps.layoutMap.isBottomAggregation(e,t)){let r=this.internalProps.layoutMap.getAggregatorOnBottom(e,t);return(null==r?void 0:r.formatValue)?r.formatValue(e,t,this):""}}let{field:l,fieldFormat:i}=this.internalProps.layoutMap.getBody(e,t);return this.getFieldData(i||l,e,t)}getCellOriginValue(e,t){if(-1===e||-1===t)return null;if(this.internalProps.layoutMap.isSeriesNumber(e,t)){if(this.internalProps.layoutMap.isSeriesNumberInHeader(e,t)){let{title:r}=this.internalProps.layoutMap.getSeriesNumberHeader(e,t);return r}let{format:r}=this.internalProps.layoutMap.getSeriesNumberBody(e,t);return"function"==typeof r?r(e,t,this):t-this.columnHeaderLevelCount}if(this.internalProps.layoutMap.isHeader(e,t)){let{title:r}=this.internalProps.layoutMap.getHeader(e,t);return"function"==typeof r?r():r}if(this.internalProps.layoutMap.isAggregation(e,t)){if(this.internalProps.layoutMap.isTopAggregation(e,t)){let r=this.internalProps.layoutMap.getAggregatorOnTop(e,t);return null==r?void 0:r.value()}if(this.internalProps.layoutMap.isBottomAggregation(e,t)){let r=this.internalProps.layoutMap.getAggregatorOnBottom(e,t);return null==r?void 0:r.value()}}let{field:r}=this.internalProps.layoutMap.getBody(e,t);return this.getFieldData(r,e,t)}getCellRawValue(e,t){if(-1===e||-1===t)return null;if(this.internalProps.layoutMap.isHeader(e,t)){let{title:r}=this.internalProps.layoutMap.getHeader(e,t);return"function"==typeof r?r():r}let{field:r}=this.internalProps.layoutMap.getBody(e,t);return this.getRawFieldData(r,e,t)}getRecordShowIndexByCell(e,t){let{layoutMap:r}=this.internalProps;return r.getRecordShowIndexByCell(e,t)}getRecordIndexByCell(e,t){let{layoutMap:r}=this.internalProps,o=r.getRecordShowIndexByCell(e,t);return this.dataSource.getRecordIndexPaths(o)}getTableIndexByRecordIndex(e){return this.transpose?this.dataSource.getTableIndex(e)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(e)+this.columnHeaderLevelCount}getTableIndexByField(e){let t=this.internalProps.layoutMap.columnObjects.find(t=>t.field===e);if(!t)return -1;let r=this.internalProps.layoutMap.getBodyLayoutRangeById(t.id);return this.transpose?r.start.row:r.start.col}getCellAddrByFieldRecord(e,t){return this.transpose?{col:this.getTableIndexByRecordIndex(t),row:this.getTableIndexByField(e)}:{col:this.getTableIndexByField(e),row:this.getTableIndexByRecordIndex(t)}}getCellOriginRecord(e,t){let r=this.getRecordShowIndexByCell(e,t);if(r>-1)return this.dataSource.get(r)}getCellRawRecord(e,t){let r=this.getRecordShowIndexByCell(e,t);if(r>-1)return this.dataSource.getRaw(r)}_canResizeColumn(e,t){let r=super._canResizeColumn(e,t);if(r&&!this.transpose){let r=this.internalProps.layoutMap.getBody(e,this.columnHeaderLevelCount),o=this.internalProps.layoutMap.isSeriesNumber(e,t);if((null==r?void 0:r.disableColumnResize)||o&&!0===this.internalProps.rowSeriesNumber.disableColumnResize)return!1}return r}updateOption(e){var t,r,o,l,s,n,a,h,u;let d=this.internalProps;if(super.updateOption(e),d.frozenColDragHeaderMode=null!=(r=null==(t=e.dragOrder)?void 0:t.frozenColDragHeaderMode)?r:e.frozenColDragHeaderMode,this.pagination=e.pagination,d.sortState=e.sortState,d.dataConfig=this.internalProps.groupBy?_(this.internalProps.groupBy):{},this.showHeader=null==(o=e.showHeader)||o,d.columns=e.columns?(0,R.u)(e.columns,["children"]):e.header?(0,R.u)(e.header,["children"]):[],(0,c.rQ)(this),d.enableTreeNodeMerge=null!=(s=null!=(l=e.enableTreeNodeMerge)?l:(0,i.Z)(this.internalProps.groupBy))&&s,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=null!=(n=e.transpose)&&n,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=e.columnWidthConfig,d.releaseList)for(let e=d.releaseList.length-1;e>=0;e--){let t=d.releaseList[e];t instanceof H.o2?t.updateColumns(this.internalProps.columns):(null==(a=null==t?void 0:t.release)||a.call(t),d.releaseList.splice(e,1))}if(e.dataSource&&this.dataSource!==e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:e.sortState}):(this.refreshRowColCount(),this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),e.title&&(d.title=new(v.F.getComponent("title"))(e.title,this),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)null==(h=this.internalProps.emptyTip)||h.resetVisible();else{let e=v.F.getComponent("emptyTip");this.internalProps.emptyTip=new e(this.options.emptyTip,this),null==(u=this.internalProps.emptyTip)||u.resetVisible()}return this.pluginManager.updatePlugins(e.plugins),new Promise(e=>{setTimeout(e,0)})}updatePagination(e){this.pagination&&("number"==typeof e.currentPage&&e.currentPage>=0&&(this.pagination.currentPage=e.currentPage),e.perPageCount&&(this.pagination.perPageCount=e.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var e;let t=this.internalProps,r=this.transpose,o=this.showHeader;(t.layoutMap=new u(this,null!=(e=t.columns)?e:[],o,this.options.hierarchyIndent)).transpose=r,r||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var e,t,r,o,l,i,s,n,a,h,u,d,c,g,p,C,w,f;let{layoutMap:m}=this.internalProps;if(!m)return;let y=null!=(t=null==(e=this.internalProps.dataSource)?void 0:e.length)?t:0;m.recordsCount=y+(y>0||this.options.showAggregationWhenEmpty?m.hasAggregationOnTopCount+m.hasAggregationOnBottomCount:0),this.transpose?(this.rowCount=null!=(r=m.rowCount)?r:0,this.colCount=null!=(o=m.colCount)?o:0,this.internalProps.frozenColCount=Math.max((null!=(l=m.headerLevelCount)?l:0)+m.leftRowSeriesNumberColumnCount,null!=(i=this.options.frozenColCount)?i:0),this.internalProps.frozenRowCount=null!=(s=this.options.frozenRowCount)?s:0,this.bottomFrozenRowCount!==(null!=(n=this.options.bottomFrozenRowCount)?n:0)&&(this.bottomFrozenRowCount=null!=(a=this.options.bottomFrozenRowCount)?a:0),this.rightFrozenColCount!==(null!=(h=this.options.rightFrozenColCount)?h:0)&&(this.rightFrozenColCount=null!=(u=this.options.rightFrozenColCount)?u:0)):(this.colCount=null!=(d=m.colCount)?d:0,this.rowCount=m.recordsCount*m.bodyRowSpanCount+m.headerLevelCount,this.internalProps.frozenColCount=null!=(c=this.options.frozenColCount)?c:0,this.frozenRowCount=Math.max(m.headerLevelCount,null!=(g=this.options.frozenRowCount)?g:0),this.bottomFrozenRowCount!==(null!=(p=this.options.bottomFrozenRowCount)?p:0)&&(this.bottomFrozenRowCount=null!=(C=this.options.bottomFrozenRowCount)?C:0),this.rightFrozenColCount!==(null!=(w=this.options.rightFrozenColCount)?w:0)&&(this.rightFrozenColCount=null!=(f=this.options.rightFrozenColCount)?f:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(e,t,r){if(null===e||this.internalProps.layoutMap.isHeader(t,r))return null;let o=this.getRecordShowIndexByCell(this.transpose?t-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:t,r);return this.internalProps.dataSource.getField(o,e,t,r,this)}getRawFieldData(e,t,r){if(null===e||this.internalProps.layoutMap.isHeader(t,r))return null;let o=this.getRecordShowIndexByCell(t,r);return this.internalProps.dataSource.getRawField(o,e,t,r,this)}_moveHeaderPosition(e,t){let r=this.getCellRange(e.col,e.row),o=this.getCellRange(t.col,t.row),l=this.internalProps.layoutMap.moveHeaderPosition(e,t);return l?("column"===l.moveType?(this.colWidthsMap.exchangeOrder(r.start.col,r.end.col-r.start.col+1,o.start.col,o.end.col-o.start.col+1,l.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):l.targetIndex>l.sourceIndex?this.rowHeightsMap.exchangeOrder(l.sourceIndex,l.sourceSize,l.targetIndex+l.sourceSize-l.targetSize,l.targetSize,l.targetIndex):this.rowHeightsMap.exchangeOrder(l.sourceIndex,l.sourceSize,l.targetIndex,l.targetSize,l.targetIndex),l):null}changeRecordOrder(e,t){this.transpose?(e=this.getRecordShowIndexByCell(e,0),t=this.getRecordShowIndexByCell(t,0)):(e=this.getRecordShowIndexByCell(0,e),t=this.getRecordShowIndexByCell(0,t)),this.dataSource.changeOrder(e,t)}getCellAddress(e,t){let r;for(let t=0;t<this.internalProps.records.length;t++){let o=this.internalProps.records[t];if("function"==typeof e)e(o)&&(r=t);else{let l=!0;for(let t in e)if(o[t]!==e[t]){l=!1;break}l&&(r=t)}if((0,i.Z)(r))break}let o=this.getCellRangeByField(t,r);if(o)return{row:o.start.row,col:o.start.col}}getCellRangeByField(e,t){let{layoutMap:r}=this.internalProps,o=r.columnObjects.find(t=>t.field===e);if(o){let e,l=r.getBodyLayoutRangeById(o.id);return(0,i.Z)(t)&&(e=r.getRecordStartRowByRecordIndex(t)),this.transpose?{start:{row:l.start.row,col:(0,i.Z)(e)?e+l.start.col:void 0},end:{row:l.end.row,col:(0,i.Z)(e)?e+l.end.col:void 0}}:{start:{col:l.start.col,row:(0,i.Z)(e)?e+l.start.row:void 0},end:{col:l.end.col,row:(0,i.Z)(e)?e+l.end.row:void 0}}}return null}getHierarchyState(e,t){var r;if(this.isHeader(e,t))return null==(r=this._getHeaderLayoutMap(e,t))?void 0:r.hierarchyState;if((!this.internalProps.groupBy||(0,d.Z)(this.internalProps.groupBy)&&0===this.internalProps.groupBy.length)&&!this.getBodyColumnDefine(e,t).tree)return o.g.none;let l=this.getRecordShowIndexByCell(e,t);return this.dataSource.getHierarchyState(l)}getRecordHierarchyState(e,t){let r;return this.transpose?this.getRecordShowIndexByCell(e,0):r=this.getRecordShowIndexByCell(0,t),this.dataSource.getHierarchyState(r)}toggleHierarchyState(e,t,r=!0){this.stateManager.updateHoverIcon(e,t,void 0,void 0);let l=this.getHierarchyState(e,t);if(this.isHeader(e,t)){let r=this.internalProps.layoutMap.getHeader(e,t),{hierarchyState:i,define:s}=r;if(![o.g.collapse,o.g.expand].includes(i)||!s)return;let n=s.columns;if(Array.isArray(n)&&n.length>0){let e=i===o.g.expand?o.g.collapse:o.g.expand;r.hierarchyState=e,r.define.hierarchyState=e,this.updateColumns(this.internalProps.columns)}this.fireListeners(p.B.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:l,originData:r,cellLocation:this.getCellLocation(e,t)})}else if(l===o.g.expand)this._refreshHierarchyState(e,t,r),this.fireListeners(p.B.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:o.g.collapse});else if(l===o.g.collapse){let l=this.getCellOriginRecord(e,t);Array.isArray(l.children)&&this._refreshHierarchyState(e,t,r),this.fireListeners(p.B.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:o.g.expand,originData:l})}}setLoadingHierarchyState(e,t){this.scenegraph.setLoadingHierarchyState(e,t)}_refreshHierarchyState(e,t,r=!0){var o,l;let i=!1,s=!1,n=this.internalProps.layoutMap.checkHasChart();n&&(this.autoFillWidth&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight));let a=this.getRecordShowIndexByCell(e,t),h=this.dataSource.toggleHierarchyState(a,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),u=this.internalProps.layoutMap.toggleHierarchyState(h);this.refreshRowColCount();for(let e=this.rowCount-this.bottomFrozenRowCount;e<this.rowCount;e++){let t=(0,m.P)(e,0,this.colCount-1,this);this._setRowHeight(e,t)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;let{updateCells:d,addCells:c,removeCells:g}=function(e,t,r,o){let l=[{col:t,row:r}],i=[],s=[],{addCellPositions:n,removeCellPositions:a}=e,h=o.scenegraph.proxy,{rowStart:u,rowLimit:d}=h,{rowEnd:c}=h,g=1/0;for(let e=0;e<n.length;e++){let{row:r}=n[e];c-u+1===d?r>=u&&r<=c&&(g=Math.min(g,r)):(i.push({col:t,row:r}),c++)}let p=Math.min(u+d,o.rowCount-1-o.bottomFrozenRowCount),C=p<u+d;for(let e=0;e<a.length;e++){let{row:r}=a[a.length-e-1];r<u||r>c||(r>p||C?(s.push({col:t,row:r}),g--):g=Math.min(g,r))}if(g!==1/0)for(let e=g;e<=c;e++)l.push({col:t,row:e});return o.scenegraph.proxy.refreshRowCount(),{updateCells:l,addCells:i,removeCells:s}}(u,e,t,this);null==(o=this.reactCustomLayout)||o.clearCache(),this.scenegraph.updateRow(g,c,d,r,!0),null==(l=this.reactCustomLayout)||l.updateAllCustomCell(),n&&(this.autoFillWidth&&!i&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!s&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||i||"adaptive"===this.heightMode||s)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var e,t;return null==(t=null!=(e=this.options.columns)?e:this.options.header)?void 0:t.some((e,t)=>e.tree)}getMenuInfo(e,t,r){return{field:this.getHeaderField(e,t),value:this.getCellValue(e,t),cellLocation:this.getCellLocation(e,t),event:void 0}}_getSortFuncFromHeaderOption(e,t,r){if(e||(e=this.internalProps.columns),t&&e&&e.length>0)for(let o=0;o<e.length;o++){let l=e[o];if((r&&r===l.fieldKey||!r&&l.field===t)&&l.sort&&"function"==typeof l.sort)return l.sort;if(l.columns){let e=this._getSortFuncFromHeaderOption(l.columns,t,r);if(e)return e}}}updateSortState(e,t=!0){var r;if(e)this.internalProps.sortState=e;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let t=0;t<this.internalProps.sortState.length;t++)(e=null==(r=this.internalProps.sortState)?void 0:r[t])&&(e.order="normal");else this.internalProps.sortState.order="normal",e=this.internalProps.sortState;(e=Array.isArray(e)?e:[e]).some(e=>e.field)&&t&&this.internalProps.layoutMap.headerObjects.some(e=>!1!==e.define.sort)&&(this.dataSource.sort(e.map(e=>{let t=this._getSortFuncFromHeaderOption(this.internalProps.columns,e.field);return this.internalProps.layoutMap.headerObjects.find(t=>t&&t.field===e.field),{field:e.field,order:e.order,orderFn:null!=t?t:y.K$}})),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),e.length&&this.stateManager.updateSortState(e)}updateFilterRules(e){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(e),A(this)):this.dataSource.updateFilterRules(e),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(e){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),(0,i.Z)(e)){let t=Array.from(this.stateManager.checkedState.keys()).sort((e,t)=>{var r,o;let l=e.split(","),i=t.split(","),s=Math.max(l.length,i.length);for(let e=0;e<s;e++){let t=null!=(r=Number(l[e]))?r:0,s=null!=(o=Number(i[e]))?o:0;if(t!==s)return t-s}return 0}).map(e=>this.stateManager.checkedState.get(e));return this.options.groupBy&&(t=(0,b.aC)(this)),Array.from(t,t=>t&&t[e])}return Array(...this.stateManager.checkedState.values())}getCellCheckboxState(e,t){var r;let o=this.getBodyColumnDefine(e,t),l=null==o?void 0:o.field,s=this.getCellType(e,t);if((0,i.Z)(l)&&("checkbox"===s||"switch"===s)){let o=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(e,t)).toString();return null==(r=this.stateManager.checkedState.get(o))?void 0:r[l]}}getRadioState(e){return(0,i.Z)(e)?this.stateManager.radioState[e]:this.stateManager.radioState}getCellRadioState(e,t){return(0,S.Wg)(e,t,this)}setCellCheckboxState(e,t,r){(0,b.Jd)(e,t,r,this)}setCellRadioState(e,t,r){(0,S.vj)(e,t,r,this)}getSwitchState(e){return this.getCheckboxState(e)}getCellSwitchState(e,t){return this.getCellCheckboxState(e,t)}setCellSwitchState(e,t,r){this.setCellCheckboxState(e,t,r)}setRecords(e,t){var r,o,l,s;let n;(0,T.H6)(),null==(r=this.internalProps.dataSource)||r.release(),this.internalProps.releaseList=null==(o=this.internalProps.releaseList)?void 0:o.filter(e=>!e.dataSourceObj),this.internalProps.dataSource=null,Array.isArray(t)||(null==t?void 0:t.order)?n=t:t?n=t.sortState:null===t&&(n=null),"undefined"!=typeof window&&window.performance.now();let a={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),void 0!==n&&(null===n||!Array.isArray(n)&&(0,i.Z)(n.field)||Array.isArray(n))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(n)?n:[n]:n,this.stateManager.setSortState(this.sortState)),e){if((0,c.mP)(this,e),this.sortState){let e=Array.isArray(this.sortState)?this.sortState:[this.sortState];e.some(e=>e.order&&e.field&&"normal"!==e.order)&&this.internalProps.layoutMap.headerObjectsIncludeHided.some(e=>!1!==e.define.sort)&&this.dataSource.sort(e.map(e=>{let t=this._getSortFuncFromHeaderOption(void 0,e.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find(t=>t&&t.field===e.field),{field:e.field,order:e.order||"asc",orderFn:null!=t?t:y.K$}}))}this.refreshRowColCount()}else(0,c.mP)(this,e);if(this.stateManager.initCheckedState(e),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(a.col,a.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)null==(l=this.internalProps.emptyTip)||l.resetVisible();else{let e=v.F.getComponent("emptyTip");this.internalProps.emptyTip=new e(this.options.emptyTip,this),null==(s=this.internalProps.emptyTip)||s.resetVisible()}this.render(),(0,i.Z)(a.col)&&(0,i.Z)(a.row)&&a.col>=0&&a.row>=0&&setTimeout(()=>{var e;null==(e=this.internalProps)||e.tooltipHandler.showTooltip(a.col,a.row)},0)}setRecordChildren(e,t,r,o=!0){let l=this.getCellOriginRecord(t,r);l.children=e;let i=this.getRecordShowIndexByCell(t,r);this.dataSource.setRecord(l,i),this._refreshHierarchyState(t,r,o)}startEditCell(e,t,r){var o;if((0,i.Z)(e)&&(0,i.Z)(t))this.eventManager.isDraging=!1,this.selectCell(e,t),this.editorManager.startEditCell(e,t,r);else if(null==(o=this.stateManager.select)?void 0:o.cellPos){let{col:e,row:t}=this.stateManager.select.cellPos;(0,i.Z)(e)&&(0,i.Z)(t)&&this.editorManager.startEditCell(e,t,r)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(e,t){var r,o;let l=this.getBodyColumnDefine(e,t),i=this.isHeader(e,t)?null!=(r=null==l?void 0:l.headerEditor)?r:this.options.headerEditor:null!=(o=null==l?void 0:l.editor)?o:this.options.editor;return"function"==typeof i&&(i=i({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),"string"==typeof i?w.U(i):i}isHasEditorDefine(e,t){var r,o;let l=this.getBodyColumnDefine(e,t),s=this.isHeader(e,t)?null!=(r=null==l?void 0:l.headerEditor)?r:this.options.headerEditor:null!=(o=null==l?void 0:l.editor)?o:this.options.editor;return"function"==typeof s&&(s=s({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),(0,i.Z)(s)}changeCellValue(e,t,r,o=!1,l=!0){return function(e,t,r,o,l,i){if(o&&i.isHasEditorDefine(e,t)||!1===o){let o=i.getRecordShowIndexByCell(e,t),{field:s}=i.internalProps.layoutMap.getBody(e,t),n=i.getCellRawValue(e,t),a=i.getCellOriginValue(e,t);i.isHeader(e,t)?i.internalProps.layoutMap.updateColumnTitle(e,t,r):i.dataSource.changeFieldValue(r,o,s,e,t,i);let h=i.getCellRange(e,t),u=i.internalProps.layoutMap.getAggregatorsByCell(e,t);if(u){if(Array.isArray(u))for(let e=0;e<(null==u?void 0:u.length);e++)u[e].recalculate();else u.recalculate();let e=i.internalProps.layoutMap.getAggregatorCellAddress(h.start.col,h.start.row,h.end.col,h.end.row);for(let t=0;t<e.length;t++){let r=i.getCellRange(e[t].col,e[t].row);for(let e=r.start.col;e<=r.end.col;e++)for(let t=r.start.row;t<=r.end.row;t++)i.scenegraph.updateCellContent(e,t)}}for(let e=h.start.col;e<=h.end.col;e++)for(let t=h.start.row;t<=h.end.row;t++)i.scenegraph.updateCellContent(e,t);if("adaptive"===i.widthMode||i.autoFillWidth&&i.getAllColsWidth()<=i.tableNoFrameWidth)0===i.internalProps._widthResizedColMap.size&&i.scenegraph.recalculateColWidths();else if(!i.internalProps._widthResizedColMap.has(e)){let t=i.getColWidth(e),r=(0,M.al)(e,0,i.rowCount-1,i,!1);r!==t&&i.scenegraph.updateColWidth(e,r-t)}if("adaptive"===i.heightMode||i.autoFillHeight&&i.getAllRowsHeight()<=i.tableNoFrameHeight)0===i.internalProps._heightResizedRowMap.size&&i.scenegraph.recalculateRowHeights();else if(i.isAutoRowHeight(t)&&!i.internalProps._heightResizedRowMap.has(t)){let e=i.getRowHeight(t),r=(0,m.P)(t,0,i.colCount-1,i);i.scenegraph.updateRowHeight(t,r-e)}let d=i.getCellOriginValue(e,t);a!==d&&l&&i.fireListeners(p.B.CHANGE_CELL_VALUE,{col:e,row:t,rawValue:n,currentValue:a,changedValue:d}),i.scenegraph.updateNextFrame()}}(e,t,r,o,l,this)}changeCellValues(e,t,r,o=!1,l=!0){return function(e,t,r,o,l,i){var s,n,a,h,u,d;return a=this,h=void 0,u=void 0,d=function*(){let a,h=[],u=e,d=t,c=[],g=[];for(let o=0;o<r.length&&!(t+o>i.rowCount-1);o++){let l=r[o],s=[],n=[];c.push(s),g.push(n);for(let r=0;r<l.length&&!(e+r>i.colCount-1);r++){a=function(e,t,r,o){if("group"===o||"sort"===o&&!r.internalProps.groupBy)return o;let l="normal";return r.internalProps.groupBy?l="group":!r.isHeader(e,t)&&r.dataSource.lastOrderField&&r.getBodyField(e,t)===r.dataSource.lastOrderField&&(l="sort"),l}(e+r,t+o,i,a);let l=i.getCellRawValue(e+r,t+o);s.push(l);let h=i.getCellOriginValue(e+r,t+o);n.push(h)}}for(let a=0;a<r.length&&!(t+a>i.rowCount-1);a++){h[a]=[],d=t+a;let C=r[a],w=e;for(let r=0;r<C.length&&!(e+r>i.colCount-1);r++){w=e+r;let u=!1;if(!1===o)u=!0;else if(i.isHasEditorDefine(e+r,t+a)){let o=i.getEditor(e+r,t+a),l=g[a][r],h=C[r],d=null==(n=null==(s=null==o?void 0:o.validateValue)?void 0:s.call(o,h,l,{col:e+r,row:t+a},i))||n;if((0,I.tI)(d)){let e=yield d;u=!0===e||"validate-exit"===e||"validate-not-exit"===e}else u=!0===d||"validate-exit"===d||"validate-not-exit"===d}if(u){h[a][r]=!0;let o=C[r],s=i.getRecordShowIndexByCell(e+r,t+a),{field:n}=i.internalProps.layoutMap.getBody(e+r,t+a),u=c[a][r],d=g[a][r];i.isHeader(e+r,t+a)?i.internalProps.layoutMap.updateColumnTitle(e+r,t+a,o):i.dataSource.changeFieldValue(o,s,n,e+r,t+a,i);let w=i.getCellOriginValue(e+r,t+a);d!==w&&l&&i.fireListeners(p.B.CHANGE_CELL_VALUE,{col:e+r,row:t+a,rawValue:u,currentValue:d,changedValue:w})}else h[a][r]=!1}u=Math.max(u,w)}let C=i.getCellRange(e,t),w=i.getCellRange(u,d),f=i.internalProps.layoutMap.getAggregatorsByCellRange(C.start.col,C.start.row,w.end.col,w.end.row);if(f){for(let e=0;e<(null==f?void 0:f.length);e++)f[e].recalculate();if("normal"===a){let e=i.internalProps.layoutMap.getAggregatorCellAddress(C.start.col,C.start.row,w.end.col,w.end.row);for(let t=0;t<e.length;t++){let r=i.getCellRange(e[t].col,e[t].row);for(let e=r.start.col;e<=r.end.col;e++)for(let t=r.start.row;t<=r.end.row;t++)i.scenegraph.updateCellContent(e,t)}}}if("group"===a&&i.dataSource.updateRecordsForGroup([],[]),"sort"===a||"group"===a)return i.dataSource.sortedIndexMap.clear(),A(i),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph(),h;for(let e=C.start.col;e<=w.end.col;e++)for(let t=C.start.row;t<=w.end.row;t++)i.scenegraph.updateCellContent(e,t);if("adaptive"===i.widthMode||i.autoFillWidth&&i.getAllColsWidth()<=i.tableNoFrameWidth)0===i.internalProps._widthResizedColMap.size&&i.scenegraph.recalculateColWidths();else for(let t=e;t<=w.end.col;t++)if(!i.internalProps._widthResizedColMap.has(t)){let e=i.getColWidth(t),r=(0,M.al)(t,0,i.rowCount-1,i,!1);r!==e&&i.scenegraph.updateColWidth(t,r-e)}if("adaptive"===i.heightMode||i.autoFillHeight&&i.getAllRowsHeight()<=i.tableNoFrameHeight)i.scenegraph.recalculateRowHeights();else if(i.isAutoRowHeight(t)){let e=[],r=[];for(let o=t;o<=w.end.row;o++)if(i.rowHeightsMap.get(o)){let t=i.getRowHeight(o),l=(0,m.P)(o,0,i.colCount-1,i);e.push(o),r.push(l-t)}i.scenegraph.updateRowsHeight(e,r)}return i.scenegraph.updateNextFrame(),h},new(u||(u=Promise))(function(e,t){function r(e){try{l(d.next(e))}catch(e){t(e)}}function o(e){try{l(d.throw(e))}catch(e){t(e)}}function l(t){var l;t.done?e(t.value):((l=t.value)instanceof u?l:new u(function(e){e(l)})).then(r,o)}l((d=d.apply(a,h||[])).next())})}(e,t,r,o,l,this)}addRecord(e,t){var r;(function(e,t,r){var o,l,i,s;if(r.internalProps.groupBy)null==(l=(o=r.dataSource).addRecordsForGroup)||l.call(o,[e],t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if("tree"===r.dataSource.rowHierarchyType)null==(s=(i=r.dataSource).addRecordsForTree)||s.call(i,[e],t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if(r.sortState)r.dataSource.addRecordForSorted(e),A(r),r.refreshRowColCount(),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else{(void 0===t||t>r.dataSource.sourceLength)&&(t=r.dataSource.sourceLength);let o=r.transpose?r.rowHeaderLevelCount:r.columnHeaderLevelCount;r.dataSource.addRecord(e,t);let l=r.rowCount;if(r.refreshRowColCount(),0===r.scenegraph.proxy.totalActualBodyRowCount)return r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();let i=r.transpose?r.colCount:r.rowCount;if(r.pagination){let{perPageCount:e,currentPage:s}=r.pagination,n=e*(s||0)+e;if(t<n)if(t<n-e)r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else{let s=t-(n-e)+o;if(l-o===r.pagination.perPageCount){let e=[];for(let t=s;t<i;t++)r.transpose?e.push({col:t,row:0}):e.push({col:0,row:t});r.transpose?r.scenegraph.updateCol([],[],e):r.scenegraph.updateRow([],[],e)}else{let e=[];for(let t=s;t<Math.min(i,s+1);t++)r.transpose?e.push({col:t,row:0}):e.push({col:0,row:t});r.transpose?r.scenegraph.updateCol([],e,[]):r.scenegraph.updateRow([],e,[])}}}else{let e=[];for(let l=t+o;l<t+o+1;l++)r.transpose?e.push({col:l,row:0}):e.push({col:0,row:l});let l=[],i=r.internalProps.layoutMap.hasAggregationOnTopCount,s=r.internalProps.layoutMap.hasAggregationOnBottomCount;for(let e=o;e<o+i;e++)r.transpose?l.push({col:e,row:0}):l.push({col:0,row:e});for(let e=(r.transpose?r.colCount:r.rowCount)-s;e<(r.transpose?r.colCount:r.rowCount);e++)r.transpose?l.push({col:e,row:0}):l.push({col:0,row:e});r.transpose?r.scenegraph.updateCol([],e,[]):r.scenegraph.updateRow([],e,[])}}})(e,t,this),null==(r=this.internalProps.emptyTip)||r.resetVisible()}addRecords(e,t){var r;(function(e,t,r){var o,l,i,s;if(r.internalProps.groupBy)null==(l=(o=r.dataSource).addRecordsForGroup)||l.call(o,e,t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if("tree"===r.dataSource.rowHierarchyType)null==(s=(i=r.dataSource).addRecordsForTree)||s.call(i,e,t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if(r.sortState)r.dataSource.addRecordsForSorted(e),A(r),r.refreshRowColCount(),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else{void 0===t||t>r.dataSource.sourceLength?t=r.dataSource.sourceLength:t<0&&(t=0);let o=r.transpose?r.rowHeaderLevelCount:r.columnHeaderLevelCount;r.dataSource.addRecords(e,t);let l=r.transpose?r.colCount:r.rowCount;if(r.refreshRowColCount(),0===r.scenegraph.proxy.totalActualBodyRowCount)return r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();let i=r.transpose?r.colCount:r.rowCount;if(r.pagination){let{perPageCount:s,currentPage:n}=r.pagination,a=s*(n||0)+s;if(t<a)if(t<a-s)r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else{let n=t-(a-s)+o;if(l-o===r.pagination.perPageCount){let e=[];for(let t=n;t<i;t++)r.transpose?e.push({col:t,row:0}):e.push({col:0,row:t});r.transpose?r.scenegraph.updateCol([],[],e):r.scenegraph.updateRow([],[],e)}else{let t=[];for(let o=n;o<Math.min(i,n+(Array.isArray(e)?e.length:1));o++)r.transpose?t.push({col:o,row:0}):t.push({col:0,row:o});r.transpose?r.scenegraph.updateCol([],t,[]):r.scenegraph.updateRow([],t,[])}}}else{let l=[];for(let i=t+o;i<t+o+(Array.isArray(e)?e.length:1);i++)r.transpose?l.push({col:i,row:0}):l.push({col:0,row:i});let i=r.internalProps.layoutMap.hasAggregationOnTopCount,s=r.internalProps.layoutMap.hasAggregationOnBottomCount,n=[];for(let e=o;e<o+i;e++)r.transpose?n.push({col:e,row:0}):n.push({col:0,row:e});for(let e=(r.transpose?r.colCount:r.rowCount)-s;e<(r.transpose?r.colCount:r.rowCount);e++)r.transpose?n.push({col:e,row:0}):n.push({col:0,row:e});r.transpose?r.scenegraph.updateCol([],l,n):r.scenegraph.updateRow([],l,n)}}})(e,t,this),null==(r=this.internalProps.emptyTip)||r.resetVisible()}deleteRecords(e){var t;(function(e,t){var r,o,l,i,s,n,a,h;if((null==e?void 0:e.length)>0)if(t.internalProps.groupBy)null==(o=(r=t.dataSource).deleteRecordsForGroup)||o.call(r,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&A(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if("tree"===t.dataSource.rowHierarchyType)null==(i=(l=t.dataSource).deleteRecordsForTree)||i.call(l,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&A(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.sortState)t.dataSource.deleteRecordsForSorted(e),A(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{let r=t.dataSource.deleteRecords(e);if(0===r.length)return;let o=t.transpose?t.colCount:t.rowCount;t.refreshRowColCount();let l=t.transpose?t.colCount:t.rowCount,i=r.sort((e,t)=>e-t),u=i[0];if(t.pagination){let{perPageCount:e,currentPage:r}=t.pagination,i=e*(r||0)+e;if(u<i)if(u<i-e)t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{let r=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,a=t.internalProps.layoutMap.hasAggregationOnTopCount,h=[],d=[];for(let r=u-(i-e)+(t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount)+a;r<l;r++)t.transpose?h.push({col:r,row:0}):h.push({col:0,row:r});for(let e=r;e<r+a;e++)t.transpose?h.push({col:e,row:0}):h.push({col:0,row:e});if(l<o)for(let e=l;e<o;e++)t.transpose?d.push({col:e,row:0}):d.push({col:0,row:e});null==(s=t.reactCustomLayout)||s.clearCache(),t.transpose?t.scenegraph.updateCol(d,[],h):t.scenegraph.updateRow(d,[],h),null==(n=t.reactCustomLayout)||n.updateAllCustomCell()}}else{let e=[],r=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,o=t.internalProps.layoutMap.hasAggregationOnTopCount,l=t.internalProps.layoutMap.hasAggregationOnBottomCount;for(let l=0;l<i.length;l++){let s=i[l]+r+o;t.transpose?e.push({col:s,row:0}):e.push({col:0,row:s})}let s=[];for(let e=r;e<r+o;e++)t.transpose?s.push({col:e,row:0}):s.push({col:0,row:e});for(let e=(t.transpose?t.colCount:t.rowCount)-l;e<(t.transpose?t.colCount:t.rowCount);e++)t.transpose?s.push({col:e,row:0}):s.push({col:0,row:e});null==(a=t.reactCustomLayout)||a.clearCache(),t.transpose?t.scenegraph.updateCol(e,[],s):t.scenegraph.updateRow(e,[],s),null==(h=t.reactCustomLayout)||h.updateAllCustomCell()}}})(e,this),null==(t=this.internalProps.emptyTip)||t.resetVisible()}updateRecords(e,t){!function(e,t,r){var o,l,i,s;if((null==t?void 0:t.length)>0)if(r.internalProps.groupBy)null==(l=(o=r.dataSource).updateRecordsForGroup)||l.call(o,e,t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if("tree"===r.dataSource.rowHierarchyType)null==(s=(i=r.dataSource).updateRecordsForTree)||s.call(i,e,t),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.sortState&&A(r),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else if(r.sortState)r.dataSource.updateRecordsForSorted(e,t),A(r),r.refreshRowColCount(),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph();else{let o=r.dataSource.updateRecords(e,t);if(0===o.length)return;let l=o.map(e=>r.getBodyRowIndexByRecordIndex(e)).sort((e,t)=>e-t);if(r.pagination){let{perPageCount:e,currentPage:t}=r.pagination,o=r.transpose?r.rowHeaderLevelCount:r.columnHeaderLevelCount,i=r.internalProps.layoutMap.hasAggregationOnTopCount,s=e*(t||0)+e,n=[];for(let t=0;t<l.length;t++){let o=l[t];if(o<s&&o>=s-e){let t=o-(s-e)+(r.transpose?r.rowHeaderLevelCount:r.columnHeaderLevelCount)+i;n.push(t)}}if(n.length>=1){let e=[];for(let t=0;t<n.length;t++){let o=n[t];r.transpose?e.push({col:o,row:0}):e.push({col:0,row:o})}for(let t=o;t<o+i;t++)r.transpose?e.push({col:t,row:0}):e.push({col:0,row:t});r.transpose?r.scenegraph.updateCol([],[],e):r.scenegraph.updateRow([],[],e)}}else{let e=[],t=r.transpose?r.rowHeaderLevelCount:r.columnHeaderLevelCount,o=r.internalProps.layoutMap.hasAggregationOnTopCount,i=r.internalProps.layoutMap.hasAggregationOnBottomCount;for(let i=0;i<l.length;i++){let s=l[i]+t+o;r.transpose?e.push({col:s,row:0}):e.push({col:0,row:s})}for(let l=t;l<t+o;l++)r.transpose?e.push({col:l,row:0}):e.push({col:0,row:l});for(let t=(r.transpose?r.colCount:r.rowCount)-i;t<(r.transpose?r.colCount:r.rowCount);t++)r.transpose?e.push({col:t,row:0}):e.push({col:0,row:t});r.transpose?r.scenegraph.updateCol([],[],e):r.scenegraph.updateRow([],[],e)}}}(e,t,this)}_hasCustomRenderOrLayout(){var e,t,r,o;let{headerObjects:l}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let i=0;i<l.length;i++){let s=l[i];if((null==(e=null==s?void 0:s.define)?void 0:e.customLayout)||(null==(t=null==s?void 0:s.define)?void 0:t.headerCustomLayout)||(null==(r=null==s?void 0:s.define)?void 0:r.customRender)||(null==(o=null==s?void 0:s.define)?void 0:o.headerCustomRender))return!0}return!1}getAggregateValuesByField(e){let t=this.internalProps.layoutMap.getColumnByField(e),r=[];for(let e=0;e<t.length;e++){let o=t[e].columnDefine.aggregator;if(delete t[e].columnDefine,o){let l={col:t[e].col,aggregateValue:null};if(l.aggregateValue=[],Array.isArray(o))for(let e=0;e<o.length;e++)l.aggregateValue.push({aggregationType:o[e].type,value:o[e].value()});else l.aggregateValue.push({aggregationType:o.type,value:o.value()});r.push(l)}}return r}isAggregation(e,t){return this.internalProps.layoutMap.isAggregation(e,t)}getGroupTitleLevel(e,t){var r;if(!this.internalProps.groupBy)return;let o=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(e,t)),l=null!=(r=this.dataSource.getGroupLength())?r:0,i=(0,d.Z)(o)?o.length-1:0;return l>0&&i===l&&(i=void 0),i}getBodyRowIndexByRecordIndex(e){return Array.isArray(e)&&1===e.length&&(e=e[0]),this.dataSource.getTableIndex(e)}_parseColumnWidthConfig(e){for(let t=0;t<(null==e?void 0:e.length);t++){let r=e[t],o=r.key,l=r.width,i=this.internalProps.layoutMap.getColumnByKey(o);if(i.columnDefine){let{col:e}=i;this.internalProps._widthResizedColMap.has(e)||(this._setColWidth(e,l),this.internalProps._widthResizedColMap.add(e))}}}release(){this.editorManager.release(),super.release()}expandAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let e=!1;this.dataSource&&"function"==typeof this.dataSource.expandAllNodes&&(this.dataSource.expandAllNodes(),e=!0),e&&(this._recreateSceneForStateChange(),this.fireListeners(p.B.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:o.g.expand,originData:{children:this.records}}))}collapseAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let e=!1;this.dataSource&&"function"==typeof this.dataSource.collapseAllNodes&&(this.dataSource.collapseAllNodes(),e=!0),e&&(this._recreateSceneForStateChange(),this.fireListeners(p.B.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:o.g.collapse,originData:{children:this.records}}))}}},90321:function(e,t,r){r.d(t,{$:()=>n});var o=r(83847),l=r(63388),i=r(77597),s=r(18585);class n{constructor(e){this.isValidatingValue=!1,this.listenersId=[],this.table=e,this.bindEvent()}bindEvent(){let e=this.table,t=e.on(o.B.DBLCLICK_CELL,t=>{var r,o,i;let{editCellTrigger:s="doubleclick"}=e.options;if(!s.includes("doubleclick"))return;let{col:n,row:a}=t,h=(0,l.RJ)(t.federatedEvent),u=e.scenegraph.getResizeColAt(h.abstractPos.x,h.abstractPos.y,null==(r=h.eventArgs)?void 0:r.targetCell);e._canResizeColumn(u.col,u.row)&&u.col>=0||(null==(i=null==(o=t.target)?void 0:o.attribute)?void 0:i.funcType)||(this.beginTriggerEditCellMode="doubleclick",this.startEditCell(n,a))}),r=e.on(o.B.CLICK_CELL,t=>{var r,o;let{editCellTrigger:l="doubleclick"}=e.options;if("click"===l||Array.isArray(l)&&l.includes("click")){if(null==(o=null==(r=t.target)?void 0:r.attribute)?void 0:o.funcType)return;this.beginTriggerEditCellMode="click";let{col:e,row:l}=t;this.startEditCell(e,l)}});this.listenersId.push(t,r)}startEditCell(e,t,r){var o,l,i,n,a,h,u,d,c;if(this.editingEditor)return;let g=this.table.getEditor(e,t);if(g){if(null==(l=null==(o=this.table.internalProps.layoutMap)?void 0:o.isAggregation)?void 0:l.call(o,e,t)){let e=null==(n=(i=this.table).isPivotTable)?void 0:n.call(i),t=!!e&&(null==(h=null==(a=this.table.internalProps)?void 0:a.dataConfig)?void 0:h.updateAggregationOnEditCell);if(!e||e&&t)return}let p=this.table.getCellRawRecord(e,t);if(null==p?void 0:p.vtableMerge)return;this.editingEditor||(this.editCell={col:e,row:t}),this.table._makeVisibleCell(e,t),this.editingEditor=g;let C=(0,s.Z)(r)?r:this.table.getCellOriginValue(e,t),w=this.table.getCellRangeRelativeRect(this.table.getCellRange(e,t)),f={rect:{left:w.left,top:w.top,width:w.width,height:w.height}};e===this.table.colCount-1?f.rect.width=w.width-1:f.rect.width=w.width+1,t===this.table.rowCount-1?f.rect.height=w.height-1:f.rect.height=w.height+1,g.beginEditing,null==(u=g.beginEditing)||u.call(g,this.table.getElement(),f,C),g.bindSuccessCallback,null==(d=g.bindSuccessCallback)||d.call(g,()=>{this.completeEdit()}),null==(c=g.onStart)||c.call(g,{value:C,endEdit:()=>{this.completeEdit()},referencePosition:f,container:this.table.getElement(),col:e,row:t,table:this.table})}}completeEdit(e){var t,r;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;let o=null==e?void 0:e.target,{editingEditor:l}=this;if(o){if(l.targetIsOnEditor){if(l.targetIsOnEditor(o))return!1}else if(!l.isEditorElement||l.isEditorElement(o))return!1}if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;let e=this.editingEditor.getValue(),o=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),l=null==(r=(t=this.editingEditor).validateValue)?void 0:r.call(t,e,o,this.editCell,this.table);return(0,i.tI)(l)?(this.isValidatingValue=!0,new Promise((e,t)=>{l.then(t=>{a(t,this,o,e)}).catch(e=>{this.isValidatingValue=!1,t(e)})})):a(l,this,o)}return this.doExit(),!0}doExit(){var e,t,r,o,l,i;let s=null==(t=(e=this.editingEditor).getValue)?void 0:t.call(e),n=this.table.getCellRange(this.editCell.col,this.editCell.row),a=[];for(let e=n.start.row;e<=n.end.row;e++){let e=[];for(let t=n.start.col;t<=n.end.col;t++)e.push(s);a.push(e)}this.table.changeCellValues(n.start.col,n.start.row,a),this.editingEditor.exit,null==(o=(r=this.editingEditor).exit)||o.call(r),null==(i=(l=this.editingEditor).onEnd)||i.call(l),this.editingEditor=null,this.isValidatingValue=!1,this.beginTriggerEditCellMode=null}cancelEdit(){var e,t,r,o;this.editingEditor&&(null==(t=(e=this.editingEditor).exit)||t.call(e),null==(o=(r=this.editingEditor).onEnd)||o.call(r),this.editingEditor=null)}release(){this.listenersId.forEach(e=>{this.table.off(e)})}}function a(e,t,r,o){return t.isValidatingValue=!1,"validate-exit"===e?(t.doExit(),null==o||o(!0),!0):"invalidate-exit"===e?(t.editingEditor.setValue(r),t.doExit(),null==o||o(!0),!0):"validate-not-exit"===e||"invalidate-not-exit"===e?(null==o||o(!1),!1):!0===e?(t.doExit(),null==o||o(!0),!0):(null==o||o(!1),!1)}}}]);